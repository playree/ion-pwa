{"version":3,"sources":["layout/sideMenuLayout.tsx","dexie.ts","helpers/settings.ts","helpers/didTools.ts","pages/top.tsx","pages/qr.tsx","pages/did.tsx","pages/vc.tsx","pages/openid.tsx","pages/settings.tsx","App.tsx","serviceWorkerRegistration.ts","reportWebVitals.ts","ServiceWorkerUpdateDialog.tsx","index.tsx"],"names":["drawerWidth","Main","styled","shouldForwardProp","prop","theme","open","flexGrow","padding","spacing","transition","transitions","create","easing","sharp","duration","leavingScreen","marginLeft","easeOut","enteringScreen","AppBar","MuiAppBar","width","DrawerHeader","display","alignItems","mixins","toolbar","justifyContent","menulink","textDecorationLine","color","fontWeight","NowLoadingContext","React","useNowLoadingContext","SettingsContext","useSettingsContext","DidContext","useDidContext","SideMenuLayout","useTheme","setOpen","isNowLoading","setNowLoading","settings","setSettings","handleDrawerClose","nowLoadingValue","settingsValue","didValue","didModel","setDidModel","Box","sx","CssBaseline","position","Toolbar","minHeight","IconButton","onClick","edge","mr","Typography","variant","noWrap","component","Drawer","flexShrink","boxSizing","anchor","direction","Divider","List","to","style","ListItem","button","ListItemIcon","minWidth","ListItemText","primary","fontSize","Provider","value","height","paddingX","Backdrop","zIndex","drawer","CircularProgress","className","SettingsModel","key","this","KEYS","URL_OPERATION","URL_RESOLVE","NEED_CHALLENGE","didlong","signingPrivateKey","recoveryPrivateKey","updatePrivateKey","KEY","dexieDb","Dexie","version","stores","did","privatekey","vc","Settings","urlOperation","urlResolve","needChallenge","get","dbUrlOperation","dbUrlResolve","dbNeedChallenge","put","load","clear","DidTool","url","keyid","signingKeyId","VerifiableTool","generateKid","IonKey","generateEs256kOperationKeyPair","recoveryKey","updateKey","generateEs256kDidDocumentKeyPair","id","signingKey","purposes","IonPublicKeyPurpose","Authentication","input","document","publicKeys","createRequest","IonRequest","createCreateRequest","longFormDid","IonDid","createLongFormDid","longFormSuffixData","substring","lastIndexOf","IonProofOfWork","submitIonRequest","urljoin","ACTION_PATH","PROOF","OPERATIONS","JSON","stringify","_submitIonRequest","resText","resObj","parse","didDocument","didParts","split","scheme","didSuffix","length","method","published","didDocumentMetadata","DidModel","solveChallengeUri","requestBody","fetch","mode","body","headers","response","status","console","text","log","responseText","IDENTIFIERS","res","error","json","ID","PrivateKeyTool","privateKey","PrivateKeyModel","RESERVE_ID","RECOVERY","UPDATE","didShort","didLong","join","VcModel","VcTool","toArray","jwsString","jwsParse","header","base64url","decode","payload","jws","jwk","sha256","createHash","jwkString","crv","kty","x","y","hash","update","digest","encode","toBase64","Date","toString","privateJwk","ES256K","sign","Error","publicJwk","verify","jwtObj","resolveUrl","kid","vid","resolve","didInfo","verificationMethod","s","vm","publicKeyJwk","verifyJws","PageTop","nowLoadingContext","settingsContext","didContext","openDidCreated","setOpenDidCreated","openDialog","setOpenDialog","title","textDialog","setTextDialog","setup","handleCloseDidCreated","event","reason","setTimeout","registerDid","save","alert","resolveDid","_resolveDid","resolveDidLong","deleteDid","closeDialog","Container","maxWidth","marginBottom","Grid","container","item","xs","Button","size","startIcon","Snackbar","autoHideDuration","onClose","Alert","severity","Chip","label","Card","CardContent","TextField","fullWidth","multiline","InputProps","readOnly","fixed","marginTop","textAlign","marginX","CardActions","Dialog","DialogTitle","DialogContent","maxRows","DialogActions","autoFocus","STATUS","PageQr","setStatus","qrText","setQrText","inputText","setInputText","navigate","useNavigate","replace","manualInput","startOpenid","requestUrl","indexOf","qr","constraints","facingMode","onResult","result","getText","qrResult","wordWrap","onChange","e","target","PageDid","signing","recovery","privateKeys","setPrivateKeys","Accordion","AccordionSummary","expandIcon","AccordionDetails","PageVc","vcList","setVcList","all","items","cnt","push","PageOpenid","search","useLocation","param","useParams","inputPin","setInputPin","credentialOffer","vcExpert","vcProcess","setVcProcess","vpProcess","setVpProcess","init","handleProc","procVc","issueVc2","verifyVc2","resVc2","parsed","QueryString","URL","query","request_uri","searchParams","append","window","location","origin","href","issuerOrigin","URLSearchParams","cache","grant_type","client_id","client_secret","code","resToken","tokenObj","now","Math","floor","reqVc","alg","typ","iss","aud","iat","exp","nonce","privateKeyModel","signJws","reqVcJws","access_token","proof_type","jwt","resVc","vcObj","decodeJws","credential","verifyJwsByDid","message","request","getCredentialOffer","getVCExpert","resJson","token","prompt","issueVc","verifyVc","manifestUrl","claims","vp_token","presentation_definition","input_descriptors","issuance","manifest2","addVC","credentialRequest","credentialIssuer","contract","sub_jwk","sub","generateSub","jti","uuid","pin","generateHash","attestations","idTokens","id_token_hint","credentialRequestJws","sendVP","idToken","_vp_token","presentation_submission","definition_id","descriptor_map","format","path","idTokenJws","vpToken","nbf","vp","type","verifiableCredential","vpTokenJws","params","state","redirect_uri","sendVP2","auth_time","path_nested","holder","proof","created","toISOString","challenge","domain","proofPurpose","bgcolor","card","backgroundColor","CardHeader","avatar","Avatar","src","logo","uri","textColor","consent","inputProps","inputMode","pattern","PageSettings","setUrlOperation","setUrlResolve","setNeedChallenge","handleChange","checked","handleClose","saveSettings","resetSettings","then","FormControlLabel","control","Checkbox","App","element","index","isLocalhost","Boolean","hostname","match","registerValidSW","swUrl","config","navigator","serviceWorker","register","registration","onupdatefound","waiting","onUpdate","installingWorker","installing","onstatechange","controller","onSuccess","reload","catch","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","SWUpdateDialog","useState","show","setShow","DialogContentText","postMessage","ReactDOM","render","StrictMode","getElementById","process","addEventListener","contentType","ready","unregister","checkValidServiceWorker","serviceWorkerRegistration","querySelector"],"mappings":"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","file":"static/js/main.6eb4dcd4.chunk.js","sourcesContent":["import * as React from 'react';\nimport { Outlet } from 'react-router-dom'\nimport { styled, useTheme } from '@mui/material/styles';\nimport { Box, Drawer, CssBaseline, Toolbar, Typography, Divider, IconButton, \n  List, ListItem, ListItemIcon, ListItemText, Backdrop, CircularProgress} from '@mui/material';\nimport MuiAppBar, { AppBarProps as MuiAppBarProps } from '@mui/material/AppBar';\nimport { \n  Menu as IconMenu,\n  ChevronLeft as IconChevronLeft,\n  ChevronRight as IconChevronRight,\n  Home as IconHome,\n  QrCode as IconQrCode,\n  Key as IconKey,\n  CardMembership as IconCardMembership,\n  Settings as IconSettings,\n} from '@mui/icons-material';\nimport { NavLink } from 'react-router-dom';\n\nimport { Settings } from '../helpers/settings';\nimport { DidModel } from '../helpers/didTools';\n\nconst buildNo = '20220701.001';\nconst drawerWidth = 200;\n\nconst Main = styled('main', { shouldForwardProp: (prop) => prop !== 'open' })<{\n  open?: boolean;\n}>(({ theme, open }) => ({\n  flexGrow: 1,\n  padding: theme.spacing(3),\n  transition: theme.transitions.create('margin', {\n    easing: theme.transitions.easing.sharp,\n    duration: theme.transitions.duration.leavingScreen,\n  }),\n  marginLeft: `-${drawerWidth}px`,\n  ...(open && {\n    transition: theme.transitions.create('margin', {\n      easing: theme.transitions.easing.easeOut,\n      duration: theme.transitions.duration.enteringScreen,\n    }),\n    marginLeft: 0,\n  }),\n}));\n\ninterface AppBarProps extends MuiAppBarProps {\n  open?: boolean;\n}\n\nconst AppBar = styled(MuiAppBar, {\n  shouldForwardProp: (prop) => prop !== 'open',\n})<AppBarProps>(({ theme, open }) => ({\n  transition: theme.transitions.create(['margin', 'width'], {\n    easing: theme.transitions.easing.sharp,\n    duration: theme.transitions.duration.leavingScreen,\n  }),\n  ...(open && {\n    width: `calc(100% - ${drawerWidth}px)`,\n    marginLeft: `${drawerWidth}px`,\n    transition: theme.transitions.create(['margin', 'width'], {\n      easing: theme.transitions.easing.easeOut,\n      duration: theme.transitions.duration.enteringScreen,\n    }),\n  }),\n}));\n\nconst DrawerHeader = styled('div')(({ theme }) => ({\n  display: 'flex',\n  alignItems: 'center',\n  padding: theme.spacing(0, 1),\n  // necessary for content to be below app bar\n  ...theme.mixins.toolbar,\n  justifyContent: 'flex-end',\n}));\n\nconst menulink = {\n  textDecorationLine: 'none',\n  color: '#444',\n  fontWeight: 'bold'\n}\n\n// ロード中表示のコンテキスト\nexport type NowLoadingContextType = {\n  isNowLoading: boolean;\n  setNowLoading: (isNowLoading: boolean) => void;\n}\nconst NowLoadingContext = React.createContext<NowLoadingContextType>({} as NowLoadingContextType);\nexport const useNowLoadingContext = ():NowLoadingContextType => {\n  return React.useContext<NowLoadingContextType>(NowLoadingContext);\n}\n\n// 設定のコンテキスト\nexport type SettingsContextType = {\n  settings: Settings | null;\n  setSettings: (settings: Settings) => void;\n}\nconst SettingsContext = React.createContext<SettingsContextType>({} as SettingsContextType);\nexport const useSettingsContext = ():SettingsContextType => {\n  return React.useContext<SettingsContextType>(SettingsContext);\n}\n\n// DID情報のコンテキスト\nexport type DidContextType = {\n  didModel: DidModel | null;\n  setDidModel: (didModel: DidModel | null) => void;\n}\nconst DidContext = React.createContext<DidContextType>({} as DidContextType);\nexport const useDidContext = ():DidContextType => {\n  return React.useContext<DidContextType>(DidContext);\n}\n\nexport const SideMenuLayout = () => {\n  const theme = useTheme();\n  const [open, setOpen] = React.useState(false);\n  const [isNowLoading, setNowLoading] = React.useState(false);\n  const [settings, setSettings] = React.useState<Settings | null>(null);\n  const [didModel, setDidModel] = React.useState<DidModel | null>(null);\n\n  const handleDrawerOpen = () => {\n    setOpen(true);\n  };\n\n  const handleDrawerClose = () => {\n    setOpen(false);\n  };\n\n  const nowLoadingValue: NowLoadingContextType = { isNowLoading, setNowLoading };\n  const settingsValue: SettingsContextType = { settings, setSettings };\n  const didValue: DidContextType = { didModel, setDidModel };\n\n  return (\n    <Box sx={{ display: 'flex' }}>\n      <CssBaseline />\n      <AppBar position=\"fixed\" open={open}>\n        <Toolbar sx={{minHeight: '40px'}}>\n          <IconButton\n            color=\"inherit\"\n            aria-label=\"open drawer\"\n            onClick={handleDrawerOpen}\n            edge=\"start\"\n            sx={{ mr: 2, ...(open && { display: 'none' }) }}\n          >\n            <IconMenu />\n          </IconButton>\n          <Typography variant=\"h6\" noWrap component=\"div\">\n            ION PWA Sample\n          </Typography>\n        </Toolbar>\n      </AppBar>\n      <Drawer\n        sx={{\n          width: drawerWidth,\n          flexShrink: 0,\n          '& .MuiDrawer-paper': {\n            width: drawerWidth,\n            boxSizing: 'border-box',\n          },\n        }}\n        variant=\"persistent\"\n        anchor=\"left\"\n        open={open}\n      >\n        <DrawerHeader>\n          <IconButton onClick={handleDrawerClose}>\n            {theme.direction === 'ltr' ? <IconChevronLeft /> : <IconChevronRight />}\n          </IconButton>\n        </DrawerHeader>\n        <Divider />\n\n        <List>\n          <NavLink to='/' style={menulink} onClick={handleDrawerClose}>\n            <ListItem button>\n              <ListItemIcon sx={{minWidth: '40px'}}><IconHome /></ListItemIcon>\n              <ListItemText primary='トップ' />\n            </ListItem>\n          </NavLink>\n          <NavLink to='/qr/' style={menulink} onClick={handleDrawerClose}>\n            <ListItem button>\n              <ListItemIcon sx={{minWidth: '40px'}}><IconQrCode /></ListItemIcon>\n              <ListItemText primary='QR読み込み' />\n            </ListItem>\n          </NavLink>\n          <NavLink to='/did/' style={menulink} onClick={handleDrawerClose}>\n            <ListItem button>\n              <ListItemIcon sx={{minWidth: '40px'}}><IconKey /></ListItemIcon>\n              <ListItemText primary='DID詳細' />\n            </ListItem>\n          </NavLink>\n          <NavLink to='/vc/' style={menulink} onClick={handleDrawerClose}>\n            <ListItem button>\n              <ListItemIcon sx={{minWidth: '40px'}}><IconCardMembership /></ListItemIcon>\n              <ListItemText primary='VC一覧' />\n            </ListItem>\n          </NavLink>\n        </List>\n        <Divider />\n        <List>\n          <NavLink to='/settings/' style={menulink} onClick={handleDrawerClose}>\n            <ListItem button>\n              <ListItemIcon sx={{minWidth: '40px'}}><IconSettings /></ListItemIcon>\n              <ListItemText primary='設定' />\n            </ListItem>\n          </NavLink>\n        </List>\n        <Divider />\n        <List>\n          <ListItem sx={{fontSize: '14px', color: 'gray'}}>\n            build: {buildNo}\n          </ListItem>\n        </List>\n\n      </Drawer>\n      <NowLoadingContext.Provider value={nowLoadingValue}>\n        <SettingsContext.Provider value={settingsValue}>\n          <DidContext.Provider value={didValue}>\n            <Main onClick={handleDrawerClose} sx={{height: '100vh', width: '100%', paddingX: '8px'}}>\n              <DrawerHeader sx={{minHeight: '40px'}} />\n              <Outlet />\n            </Main>\n            <Backdrop\n              sx={{ color: '#fff', zIndex: (theme) => theme.zIndex.drawer + 1 }}\n              open={nowLoadingValue.isNowLoading}\n            >\n              <CircularProgress color=\"inherit\" />\n            </Backdrop>\n          </DidContext.Provider>\n        </SettingsContext.Provider>\n      </NowLoadingContext.Provider>\n      <div className=\"SW-update-dialog\"></div>\n    </Box>\n  );\n}\n","import { Dexie, Table } from 'dexie';\nimport JwkEs256k from '@decentralized-identity/ion-sdk/dist/lib/models/JwkEs256k'\n\nimport { DidModel, PrivateKeyModel, VcModel } from './helpers/didTools';\n\n// スキーマの修正がある場合、この値を変更する必要あり\nconst SCHEMA_VERSION = 2\n\nexport class SettingsModel {\n  key: string;\n  value: any;\n  constructor(key: string, value: any) {\n    this.key = key;\n    this.value = value;\n  };\n\n  static KEYS = {\n    URL_OPERATION: 'URL_OPERATION',\n    URL_RESOLVE: 'URL_RESOLVE',\n    NEED_CHALLENGE: 'NEED_CHALLENGE',\n  }\n};\n\nexport class DidInfoModel {\n  key: string;\n  didlong: string;\n  signingPrivateKey: JwkEs256k;\n  recoveryPrivateKey: JwkEs256k;\n  updatePrivateKey: JwkEs256k;\n  constructor(\n    key: string, \n    didlong: string,\n    signingPrivateKey: JwkEs256k,\n    recoveryPrivateKey: JwkEs256k,\n    updatePrivateKey: JwkEs256k\n    ) {\n    this.key = key;\n    this.didlong = didlong;\n    this.signingPrivateKey = signingPrivateKey;\n    this.recoveryPrivateKey = recoveryPrivateKey;\n    this.updatePrivateKey = updatePrivateKey;\n  };\n\n  static KEY = 'KEY';\n};\n\ninterface IonPwaDatabase extends Dexie {\n  settings: Table<SettingsModel, string>;\n  did: Table<DidModel, string>;\n  privatekey: Table<PrivateKeyModel, string>;\n  vc: Table<VcModel, number>;\n};\nexport const dexieDb = new Dexie('ionpwa-db') as IonPwaDatabase;\n\ndexieDb.version(SCHEMA_VERSION).stores({\n  settings: 'key',\n  did: 'id',\n  privatekey: 'id',\n  vc: '++id',\n});","import { dexieDb, SettingsModel } from '../dexie';\n\nexport class Settings {\n  urlOperation: string;\n  urlResolve: string;\n  needChallenge: boolean;\n\n  constructor(){\n    // デフォルト値\n    this.urlOperation = 'https://beta.ion.msidentity.com/api/v1.0/';\n    this.urlResolve = 'https://beta.discover.did.microsoft.com/1.0/';\n    this.needChallenge = true;\n  }\n\n  async load() {\n    // indexedDBからLoad\n    const dbUrlOperation = await dexieDb.settings.get(SettingsModel.KEYS.URL_OPERATION);\n    if (dbUrlOperation) {\n      this.urlOperation = dbUrlOperation.value;\n    }\n    const dbUrlResolve = await dexieDb.settings.get(SettingsModel.KEYS.URL_RESOLVE);\n    if (dbUrlResolve) {\n      this.urlResolve = dbUrlResolve.value;\n    }\n    const dbNeedChallenge = await dexieDb.settings.get(SettingsModel.KEYS.NEED_CHALLENGE);\n    if (dbNeedChallenge) {\n      this.needChallenge = dbNeedChallenge.value;\n    }\n  }\n\n  async save() {\n    // indexedDBにSave\n    await dexieDb.settings.put(new SettingsModel(SettingsModel.KEYS.URL_OPERATION, this.urlOperation));\n    await dexieDb.settings.put(new SettingsModel(SettingsModel.KEYS.URL_RESOLVE, this.urlResolve));\n    await dexieDb.settings.put(new SettingsModel(SettingsModel.KEYS.NEED_CHALLENGE, this.needChallenge));\n  }\n\n  static async load() {\n    const settings = new Settings();\n    await settings.load();\n    return settings;\n  }\n\n  static async clear() {\n    await dexieDb.settings.clear();\n  }\n}","import { IonDid, IonDocumentModel, IonKey, IonRequest, IonPublicKeyPurpose } from '@decentralized-identity/ion-sdk';\nimport JwkEs256k from '@decentralized-identity/ion-sdk/dist/lib/models/JwkEs256k';\nimport IonProofOfWork from 'ion-pow-sdk';\nimport { dexieDb } from '../dexie';\nimport urljoin from 'url-join';\nimport { fetch } from 'cross-fetch';\nimport base64url from 'base64url';\nimport { createHash } from 'crypto';\nimport { ES256K } from '@transmute/did-key-secp256k1';\n\nexport class DidTool {\n  static ACTION_PATH = {\n    OPERATIONS: 'operations',\n    IDENTIFIERS: 'identifiers',\n\n    PROOF: 'proof-of-work-challenge',\n  };\n\n  static async create(url: string, needChallenge: boolean, keyid: string = '') {\n    const signingKeyId = keyid ? keyid : VerifiableTool.generateKid();\n\n    // 鍵生成\n    const [recoveryKey, recoveryPrivateKey] = await IonKey.generateEs256kOperationKeyPair();\n    const [updateKey, updatePrivateKey] = await IonKey.generateEs256kOperationKeyPair();\n    const [signingKey, signingPrivateKey] = await IonKey.generateEs256kDidDocumentKeyPair({id: signingKeyId});\n    \n    // 追加属性\n    signingKey.purposes = [IonPublicKeyPurpose.Authentication];\n    const publicKeys = [signingKey];\n\n    // DID作成リクエスト\n    const document : IonDocumentModel = {\n      publicKeys\n    };\n    const input = { recoveryKey, updateKey, document };\n    const createRequest = IonRequest.createCreateRequest(input);\n    const longFormDid = IonDid.createLongFormDid(input);\n    const longFormSuffixData = longFormDid.substring(longFormDid.lastIndexOf(':') + 1);\n\n    const resText = needChallenge ? \n      await IonProofOfWork.submitIonRequest(\n        urljoin(url, DidTool.ACTION_PATH.PROOF),\n        urljoin(url, DidTool.ACTION_PATH.OPERATIONS),\n        JSON.stringify(createRequest)\n      ) :\n      await DidTool._submitIonRequest(\n        urljoin(url, DidTool.ACTION_PATH.OPERATIONS),\n        JSON.stringify(createRequest)\n      );\n    if (!resText) {\n      return null;\n    };\n\n    // 各種パラメータ生成\n    const resObj = JSON.parse(resText);\n    const did: string = resObj.didDocument.id;\n    const didParts = did.split(':');\n    const scheme = didParts[0];\n    const didSuffix = didParts[didParts.length - 1];\n    let method = didParts[1];\n    if (didParts.length === 4) {\n      method +=  ':' +  didParts[2];\n    };\n    const published = resObj.didDocumentMetadata.method.published;\n\n    const didModel = new DidModel(\n      scheme,\n      method,\n      didSuffix,\n      longFormSuffixData,\n      signingKeyId,\n      published\n    );\n\n    return {\n      didModel: didModel,\n      signingPrivateKey: signingPrivateKey,\n      recoveryPrivateKey: recoveryPrivateKey,\n      updatePrivateKey: updatePrivateKey,\n    };\n  };\n\n  static async _submitIonRequest(solveChallengeUri: string, requestBody: string) {\n    const response = await fetch(solveChallengeUri, {\n      method: 'POST',\n      mode: 'cors',\n      body: requestBody,\n      headers: {\n        'Content-Type': 'application/json'\n      }\n    });\n\n    if (response.status >= 500) {\n      console.log(`Unexpected 5xx response: ${await response.text()}`);\n    } else if (response.status >= 400) {\n      // 400 means bad request, so should retry with a new challenge\n      console.log(`Bed request: ${await response.text()}`);\n      console.log('Retrying with new challenge and difficulty');\n    } else if (response.status >= 300) {\n      console.log(`Unexpected 3xx response: ${await response.text()}`);\n    } else {\n      //success\n      console.log(`Successful registration`);\n      const responseText = await response.text();\n      console.log(responseText);\n      return responseText;\n    };\n  };\n\n  static async resolve(url: string, did: string) {\n    const res = await fetch(urljoin(url, DidTool.ACTION_PATH.IDENTIFIERS, did));\n    if (res.status !== 200) {\n      return {\n        error: {\n          status: res.status,\n          text: await res.text()\n        }\n      }\n    }\n    return await res.json();\n  }\n\n  static async save(didModel: DidModel) {\n    await dexieDb.did.put(didModel);\n  }\n\n  static async load() {\n    const didModel = await dexieDb.did.get(DidModel.ID);\n    if (didModel) {\n      return new DidModel(\n        didModel.scheme,\n        didModel.method,\n        didModel.didSuffix,\n        didModel.longFormSuffixData,\n        didModel.signingKeyId,\n        didModel.published\n      );\n    }\n    return null;\n  };\n\n  static async clear() {\n    await dexieDb.did.clear();\n  }\n};\n\nexport class PrivateKeyTool {\n  static RESERVE_ID = {\n    RECOVERY: '@RECOVERY',\n    UPDATE: '@UPDATE'\n  }\n\n  static async save(id: string, privateKey: JwkEs256k) {\n    await dexieDb.privatekey.put(new PrivateKeyModel(id, privateKey));\n  };\n  static async load(id: string) {\n    return await dexieDb.privatekey.get(id);\n  };\n  static async clear() {\n    await dexieDb.privatekey.clear();\n  }\n};\n\nexport class DidModel {\n  // did = scheme:method:didSuffix:longFormSuffixData\n  id: string;\n  scheme: string;\n  method: string;\n  didSuffix: string;\n  longFormSuffixData: string;\n  signingKeyId: string;\n  published: boolean;\n\n  constructor(\n    scheme: string,\n    method: string,\n    didSuffix: string,\n    longFormSuffixData: string,\n    signingKeyId: string,\n    published = false\n    ) {\n    this.id = DidModel.ID;\n    this.scheme = scheme;\n    this.method = method;\n    this.didSuffix = didSuffix;\n    this.longFormSuffixData = longFormSuffixData;\n    this.signingKeyId = signingKeyId;\n    this.published = published;\n  };\n\n  get did() {\n    return this.published ? this.didShort : this.didLong;\n  };\n\n  get didShort() {\n    return [this.scheme, this.method, this.didSuffix].join(':');\n  };\n\n  get didLong() {\n    return [this.scheme, this.method, this.didSuffix, this.longFormSuffixData].join(':');\n  };\n\n  get kid() {\n    return `${this.did}#${this.signingKeyId}`;\n  };\n\n  static ID = 'onlyid';\n};\n\nexport class PrivateKeyModel {\n  id: string;\n  privateKey: JwkEs256k;\n\n  constructor(id: string, privateKey: JwkEs256k) {\n    this.id = id;\n    this.privateKey = privateKey;\n  };\n};\n\nexport class VcModel {\n  id: number | undefined;\n  vc: JWTObject;\n\n  constructor(vc: JWTObject) {\n    this.vc = vc;\n  };\n};\n\nexport class VcTool {\n  static async save(vc: JWTObject) {\n    await dexieDb.vc.put(new VcModel(vc));\n  };\n  static async all() {\n    return await dexieDb.vc.toArray();\n  };\n  static async clear() {\n    await dexieDb.vc.clear();\n  }\n};\n\nexport class VerifiableTool {\n  static decodeJws(jwsString: string): JWTObject {\n    const jwsParse = jwsString.split('.');\n    return {\n      header: JSON.parse(base64url.decode(jwsParse[0])),\n      payload: JSON.parse(base64url.decode(jwsParse[1])),\n      jws: jwsString\n    };\n  };\n\n  static generateSub(jwk: any) {\n    const sha256 = createHash('sha256');\n    const jwkString = `{\"crv\":\"${jwk.crv}\",\"kty\":\"${jwk.kty}\",\"x\":\"${jwk.x}\",\"y\":\"${jwk.y}\"}`;\n    const hash = sha256.update(jwkString).digest();\n    return base64url.encode(hash);\n  };\n\n  static generateHash(text: any) {\n    const sha256 = createHash('sha256');\n    const hash = sha256.update(text).digest();\n    return base64url.toBase64(base64url.encode(hash));\n  };\n\n  static generateKid() {\n    const md5 = createHash('md5');\n    return md5.update(new Date().toString()).digest('hex');\n  }\n\n  static generateNonce() {\n    const md5 = createHash('md5');\n    const hash = md5.update(new Date().toString()).digest();\n    return base64url.toBase64(base64url.encode(hash));\n  }\n\n  static async signJws(header: any, payload: any, privateJwk: any){\n    switch(privateJwk.crv){\n      case 'secp256k1':\n        return ES256K.sign(payload, privateJwk, header);\n      default: throw new Error('Unsupported cryptographic type');\n    };\n  };\n\n  static async verifyJws(jws: string, publicJwk: any){\n    switch(publicJwk.crv){\n      case 'secp256k1':\n        return ES256K.verify(jws, publicJwk);\n      default: throw new Error('Unsupported cryptographic type');\n    };\n  };\n\n  static async verifyJwsByDid(jwtObj: JWTObject, resolveUrl: string) {\n    try {\n      // HeaderのkidからDIDとverificationMethodのidを取得\n      const [did, vid] = jwtObj.header.kid.split('#');\n      \n      // DID DocumentからpublicKeyJwkを取得\n      const didInfo = await DidTool.resolve(resolveUrl, did);\n      let jwk;\n      for (const vm of didInfo.didDocument.verificationMethod) {\n        if (vm.id === ('#' + vid)) {\n          jwk = vm.publicKeyJwk;\n          break;\n        }\n      }\n      if (!jwk) {\n        return false;\n      };\n\n      // 署名検証\n      return await VerifiableTool.verifyJws(jwtObj.jws, jwk);\n    } catch (e) {\n      return false;\n    };\n  };\n\n}\n\nexport type JWTObject = {\n  header: any,\n  payload: any,\n  jws: string,\n}\n","import * as React from 'react';\nimport { Typography, Container, Grid, Button, Snackbar, Alert, \n  Card, CardContent, CardActions, TextField, Chip, \n  Dialog, DialogTitle, DialogContent, DialogActions, Divider} from '@mui/material';\nimport { \n  Create as IconCreate\n} from '@mui/icons-material'\n\nimport { Settings } from '../helpers/settings';\nimport { DidTool, PrivateKeyTool, VcTool } from '../helpers/didTools';\nimport { useNowLoadingContext, useSettingsContext, useDidContext } from '../layout/sideMenuLayout';\n\nexport const PageTop = () => {\n  const nowLoadingContext = useNowLoadingContext();\n  const settingsContext = useSettingsContext();\n  const didContext = useDidContext();\n\n  const [openDidCreated, setOpenDidCreated] = React.useState(false);\n  const [openDialog, setOpenDialog] = React.useState(false);\n  const [textDialog, setTextDialog] = React.useState({title:'', text:''});\n\n  React.useEffect(() => {\n    if (!settingsContext.settings) {\n      setup();\n    };\n    return () => {\n      \n    };\n  });\n\n  const handleCloseDidCreated = (event?: React.SyntheticEvent | Event, reason?: string) => {\n    if (reason === 'clickaway') {\n      return;\n    }\n    setOpenDidCreated(false);\n  };\n\n  /**\n   * 各種読み込み\n   */\n  const setup = async () => {\n    nowLoadingContext.setNowLoading(true);\n\n    // 設定の読み込み\n    settingsContext.setSettings(await Settings.load());\n\n    // DIDの読み込み\n    const didModel = await DidTool.load();\n    if (didModel) {\n      didContext.setDidModel(didModel);\n    }\n\n    setTimeout(() => {\n      nowLoadingContext.setNowLoading(false);\n    }, 300);\n  };\n\n  const registerDid = async () => {\n    if (!settingsContext.settings) {\n      return\n    }\n    nowLoadingContext.setNowLoading(true);\n    \n    // DID発行\n    try {\n      const didInfo = await DidTool.create(settingsContext.settings.urlOperation, settingsContext.settings.needChallenge, 'sign-primary-key');\n    \n      if (didInfo) {\n        // 発行した各種情報を保存\n        await PrivateKeyTool.save(didInfo.didModel.signingKeyId, didInfo.signingPrivateKey);\n        await PrivateKeyTool.save(PrivateKeyTool.RESERVE_ID.RECOVERY, didInfo.recoveryPrivateKey);\n        await PrivateKeyTool.save(PrivateKeyTool.RESERVE_ID.UPDATE, didInfo.updatePrivateKey);\n        await DidTool.save(didInfo.didModel);\n\n        // コンテキストにも反映\n        didContext.setDidModel(didInfo.didModel);\n\n        setOpenDidCreated(true);\n      } else {\n        alert('DIDの発行に失敗しました。');\n      }\n    } catch {\n      alert('DIDの発行に失敗しました。');\n    }\n\n    setTimeout(() => {\n      nowLoadingContext.setNowLoading(false);\n    }, 300);\n  };\n\n  const resolveDid = async () => {\n    if (!didContext.didModel) {\n      return\n    }\n    return await _resolveDid(didContext.didModel.didShort);\n  };\n\n  const resolveDidLong = async () => {\n    if (!didContext.didModel) {\n      return\n    }\n    return await _resolveDid(didContext.didModel.didLong);\n  };\n\n  const _resolveDid = async (did: string) => {\n    if (!settingsContext.settings) {\n      return\n    }\n    if (!didContext.didModel) {\n      return\n    }\n    nowLoadingContext.setNowLoading(true);\n\n    const resolveDid = await DidTool.resolve(settingsContext.settings.urlResolve, did);\n    if (!resolveDid.error) {\n      if (!didContext.didModel.published) {\n        if (resolveDid.didDocumentMetadata.method.published) {\n          // publishedの更新\n          didContext.didModel.published = true;\n          didContext.setDidModel(didContext.didModel);\n          await DidTool.save(didContext.didModel);\n        }\n      }\n    }\n\n    setTimeout(() => {\n      setTextDialog({\n        title: 'DID検証レスポンス',\n        text: JSON.stringify(resolveDid, null, 2)\n      });\n      setOpenDialog(true);\n      nowLoadingContext.setNowLoading(false);\n    }, 500);\n  };\n\n  const deleteDid = async () => {\n    nowLoadingContext.setNowLoading(true);\n\n    // 発行した各種情報を削除\n    await VcTool.clear();\n    await PrivateKeyTool.clear();\n    await DidTool.clear();\n\n    // コンテキストにも反映\n    didContext.setDidModel(null);\n\n    setTimeout(() => {\n      nowLoadingContext.setNowLoading(false);\n    }, 300);\n  };\n\n  const closeDialog = async () => {\n    setOpenDialog(false);\n  };\n\n  if (!didContext.didModel) {\n    return (\n      <>\n        <Container maxWidth='sm' sx={{paddingX: '8px'}}>\n          <Typography variant='h5' sx={{marginBottom: '16px'}}>\n            DID\n          </Typography>\n          <Grid container spacing={2}>\n            <Grid item xs={12}>\n              DIDが発行されていません。\n            </Grid>\n            <Grid container item xs={12} justifyContent='center'>\n              <Button variant='contained' size='large' startIcon={<IconCreate />} onClick={registerDid}>DID発行</Button>\n            </Grid>\n          </Grid>\n        </Container>\n        <Snackbar open={openDidCreated} autoHideDuration={6000} onClose={handleCloseDidCreated}>\n          <Alert onClose={handleCloseDidCreated} severity=\"success\" sx={{ width: '100%' }}>\n            DIDを発行しました。\n          </Alert>\n        </Snackbar>\n      </>\n    );\n  }\n\n  const published = didContext.didModel.published ? <Chip label='公開済' color='success' /> : <Chip label='未公開' color='warning' />;\n  return (\n    <>\n      <Container maxWidth='sm' sx={{paddingX: '8px'}}>\n        <Typography variant='h5' sx={{marginBottom: '16px'}}>\n          DID\n        </Typography>\n        <Grid container spacing={2}>\n          <Grid item xs={12}>\n            <Card variant='outlined'>\n              <CardContent>\n                <TextField\n                  label='DID'\n                  fullWidth\n                  multiline\n                  value={didContext.didModel.didShort}\n                  InputProps={{\n                    readOnly: true,\n                  }}\n                />\n                <Container fixed sx={{marginTop: '8px', textAlign: 'right'}} >\n                  {published}\n                </Container>\n              </CardContent>\n              <Divider sx={{marginX: '8px'}} />\n              <CardActions>\n                <Button size='small' onClick={resolveDid}>DIDを検証</Button>\n                <Button size='small' onClick={resolveDidLong}>DID(Long)を検証</Button>\n                <Button size='small' color='error' onClick={deleteDid}>削除</Button>\n              </CardActions>\n            </Card>\n          </Grid>\n        </Grid>\n      </Container>\n      <Snackbar open={openDidCreated} autoHideDuration={6000} onClose={handleCloseDidCreated}>\n        <Alert onClose={handleCloseDidCreated} severity=\"success\" sx={{ width: '100%' }}>\n          DIDを発行しました。\n        </Alert>\n      </Snackbar>\n      <Dialog\n        fullWidth={true}\n        maxWidth='sm'\n        open={openDialog}\n        aria-labelledby=\"responsive-dialog-title\"\n      >\n        <DialogTitle id=\"responsive-dialog-title\">\n          {textDialog.title}\n        </DialogTitle>\n        <DialogContent>\n          <TextField\n            label='DID'\n            fullWidth\n            multiline\n            maxRows={16}\n            value={textDialog.text}\n            InputProps={{\n              readOnly: true,\n              sx: {fontSize: '11px'}\n            }}\n            sx={{ marginTop: '8px' }}\n          />\n        </DialogContent>\n        <DialogActions>\n          <Button onClick={closeDialog} autoFocus>\n            OK\n          </Button>\n        </DialogActions>\n      </Dialog>\n    </>\n  );\n}","import * as React from 'react';\nimport { Navigate, useNavigate } from 'react-router-dom';\nimport { Typography, Container, Card, CardContent, Button, TextField } from '@mui/material';\nimport { QrReader } from 'react-qr-reader';\nimport { useDidContext, useSettingsContext } from '../layout/sideMenuLayout';\nimport base64url from 'base64url';\n\nconst STATUS = {\n  QR_READ: 0,\n  QR_READED: 1,\n};\n\nexport const PageQr = () => {\n  const [status, setStatus] = React.useState(STATUS.QR_READ);\n  const [qrText, setQrText] = React.useState('');\n  const [inputText, setInputText] = React.useState('');\n\n  const didContext = useDidContext();\n  const settingsContext = useSettingsContext();\n  const navigate = useNavigate();\n\n  if (!didContext.didModel) {\n    return (<Navigate to=\"/\" replace />);\n  };\n\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    switch (e.target.id) {\n      case 'input-text':\n        setInputText(() => e.target.value)\n        break;\n    };\n  };\n\n  const manualInput = async () => {\n    startOpenid(inputText);\n  };\n\n  const startOpenid = async (requestUrl: string) => {\n    if (!settingsContext.settings) {\n      return\n    };\n    if (!didContext.didModel) {\n      return\n    };\n\n    if (requestUrl.indexOf('openid://') !== 0) {\n      alert('openid:// 形式のみ有効です')\n      return;\n    };\n\n    navigate('/openid/' + base64url.encode(requestUrl));\n  }\n\n  const qr = (\n    <QrReader\n      constraints={{ facingMode: 'environment' }}\n      onResult={(result) => {\n        if (result) {\n          console.log(result);\n          setQrText(result.getText());\n          setStatus(STATUS.QR_READED);\n\n          if (result.getText().indexOf('openid://vc') === 0) {\n            startOpenid(result.getText());\n          };\n        }\n      }}\n    />\n  );\n\n  const qrResult = (\n    <Card variant='outlined'>\n      <CardContent>\n        <Typography variant='h6'>\n          QR読み取り結果\n        </Typography>\n        <Typography sx={{wordWrap: 'break-word', marginTop: '16px'}}>\n          { qrText }\n        </Typography>\n      </CardContent>\n    </Card>\n  );\n\n  return (\n    <Container maxWidth='sm' sx={{paddingX: '8px'}}>\n      <Typography variant='h5' sx={{marginBottom: '16px'}}>\n        QR読み取り\n      </Typography>\n      <Container maxWidth='sm'>\n        { status === STATUS.QR_READED ? qrResult : qr }\n      </Container>\n      <Container maxWidth='sm' sx={{marginTop: '16px'}}>\n        <TextField id='input-text' label='URL(openid://)' fullWidth multiline maxRows={6} size='small' value={inputText} onChange={handleChange} />\n        <Button variant='contained' sx={{marginTop: '8px'}} onClick={manualInput}>手入力</Button>\n      </Container>\n    </Container>\n  );\n}","import * as React from 'react';\nimport { Navigate } from 'react-router-dom';\nimport { Typography, Container, TextField, Accordion, AccordionSummary, AccordionDetails} from '@mui/material';\nimport { \n  ExpandMore as IconExpandMore\n} from '@mui/icons-material'\nimport { useDidContext } from '../layout/sideMenuLayout';\nimport { PrivateKeyTool } from '../helpers/didTools';\n\nexport const PageDid = () => {\n  const didContext = useDidContext();\n  const [privateKeys, setPrivateKeys] = React.useState({signing:'', recovery:'', update:''});\n\n  React.useEffect(() => {\n    if (!privateKeys.signing) {\n      setup();\n    }\n    return () => {\n      \n    };\n  });\n\n  const setup = async () => {\n    if (didContext.didModel) {\n      setPrivateKeys({\n        signing: JSON.stringify((await PrivateKeyTool.load(didContext.didModel.signingKeyId))?.privateKey, null, 2),\n        recovery: JSON.stringify((await PrivateKeyTool.load(PrivateKeyTool.RESERVE_ID.RECOVERY))?.privateKey, null, 2),\n        update: JSON.stringify((await PrivateKeyTool.load(PrivateKeyTool.RESERVE_ID.UPDATE))?.privateKey, null, 2)\n      });\n    };\n  };\n\n  if (!didContext.didModel) {\n    return (<Navigate to=\"/\" replace />);\n  };\n\n  return (\n    <>\n      <Container maxWidth='sm' sx={{paddingX: '8px'}}>\n        <Typography variant='h5' sx={{marginBottom: '16px'}}>\n          DID詳細\n        </Typography>\n        <Accordion>\n          <AccordionSummary expandIcon={<IconExpandMore />}>\n            <Typography>DID(Long)</Typography>\n          </AccordionSummary>\n          <AccordionDetails>\n            <TextField\n              label='DID(Long)'\n              fullWidth\n              multiline\n              maxRows={8}\n              value={didContext.didModel.didLong}\n              InputProps={{\n                readOnly: true,\n                sx: {fontSize: '12px'}\n              }}\n            />\n          </AccordionDetails>\n        </Accordion>\n        <Accordion>\n          <AccordionSummary expandIcon={<IconExpandMore />}>\n            <Typography>SigningPrivateKey</Typography>\n          </AccordionSummary>\n          <AccordionDetails>\n            <TextField\n              label='SigningPrivateKey'\n              fullWidth\n              multiline\n              maxRows={8}\n              value={privateKeys.signing}\n              InputProps={{\n                readOnly: true,\n                sx: {fontSize: '12px'}\n              }}\n            />\n          </AccordionDetails>\n        </Accordion>\n        <Accordion>\n          <AccordionSummary expandIcon={<IconExpandMore />}>\n            <Typography>RecoveryPrivateKey</Typography>\n          </AccordionSummary>\n          <AccordionDetails>\n            <TextField\n              label='RecoveryPrivateKey'\n              fullWidth\n              multiline\n              maxRows={8}\n              value={privateKeys.recovery}\n              InputProps={{\n                readOnly: true,\n                sx: {fontSize: '12px'}\n              }}\n            />\n          </AccordionDetails>\n        </Accordion>\n        <Accordion>\n          <AccordionSummary expandIcon={<IconExpandMore />}>\n            <Typography>UpdatePrivateKey</Typography>\n          </AccordionSummary>\n          <AccordionDetails>\n            <TextField\n              label='UpdatePrivateKey'\n              fullWidth\n              multiline\n              maxRows={8}\n              value={privateKeys.update}\n              InputProps={{\n                readOnly: true,\n                sx: {fontSize: '12px'}\n              }}\n            />\n          </AccordionDetails>\n        </Accordion>\n        \n      </Container>\n    </>\n  );\n}","import * as React from 'react';\nimport { Navigate } from 'react-router-dom';\nimport { Typography, Container, TextField, Accordion, AccordionSummary, AccordionDetails} from '@mui/material';\nimport { \n  ExpandMore as IconExpandMore\n} from '@mui/icons-material'\nimport { useDidContext } from '../layout/sideMenuLayout';\nimport { VcModel, VcTool } from '../helpers/didTools';\n\nexport const PageVc = () => {\n  const didContext = useDidContext();\n  const [vcList, setVcList] = React.useState([] as VcModel[]);\n\n  React.useEffect(() => {\n    if (!vcList.length) {\n      setup();\n    };\n    return () => {\n      \n    };\n  });\n\n  const setup = async () => {\n    const vcList = await VcTool.all();\n    setVcList(vcList);\n  };\n\n  if (!didContext.didModel) {\n    return (<Navigate to=\"/\" replace />);\n  };\n\n  const items = [];\n  for (var cnt = 0; cnt < vcList.length; cnt++) {\n    items.push(\n      <Accordion key={'ac_' + cnt}>\n        <AccordionSummary expandIcon={<IconExpandMore />}>\n          <Typography>VC {cnt}</Typography>\n        </AccordionSummary>\n        <AccordionDetails>\n          <TextField\n            label='vc'\n            fullWidth\n            multiline\n            maxRows={8}\n            value={JSON.stringify(vcList[cnt].vc.payload, null, 2)}\n            InputProps={{\n              readOnly: true,\n              sx: {fontSize: '12px'}\n            }}\n          />\n        </AccordionDetails>\n      </Accordion>\n    );\n  }\n\n  return (\n    <>\n      <Container maxWidth='sm' sx={{paddingX: '8px'}}>\n        <Typography variant='h5' sx={{marginBottom: '16px'}}>\n          VC一覧\n        </Typography>\n        { items }\n        \n      </Container>\n    </>\n  );\n}","import * as React from 'react';\nimport { useNavigate, useLocation } from 'react-router-dom';\nimport { Typography, Container, Card, CardContent, CardHeader, Button, TextField, Avatar, Grid } from '@mui/material';\nimport { fetch } from 'cross-fetch';\nimport * as QueryString from 'query-string';\nimport { VerifiableTool, DidTool, PrivateKeyTool, VcTool, JWTObject, VcModel } from '../helpers/didTools';\nimport { useDidContext, useSettingsContext, useNowLoadingContext } from '../layout/sideMenuLayout';\nimport * as uuid from 'uuid';\nimport { useParams } from 'react-router';\nimport base64url from 'base64url';\nimport { Settings } from '../helpers/settings';\n\n// @todo \nconst STATUS = {\n  INIT: 0,\n  START: 1,\n  SIOP_VC_CONFIRM: 11,\n  SIOP_VC_RECEIVED: 12,\n  SIOP_VP_CONFIRM: 21,\n  SIOP_VP_VERIFIED: 22,\n  SIOP_VP2_CONFIRM: 31,\n  SIOP_VP2_VERIFIED: 32,\n};\n\ntype Params = {\n  param: string;\n};\n\nexport const PageOpenid = () => {\n  const search = useLocation().search;\n  const { param } = useParams<Params>();\n  const [status, setStatus] = React.useState(STATUS.INIT);\n  const [inputPin, setInputPin] = React.useState('');\n  const [vcProcess, setVcProcess] = React.useState({\n    credentialOffer: {} as JWTObject, \n    vcExpert: {} as JWTObject,\n  });\n  const [vpProcess, setVpProcess] = React.useState({\n    credentialOffer: {} as JWTObject, \n    vcList: [] as VcModel[],\n  });\n\n  const didContext = useDidContext();\n  const settingsContext = useSettingsContext();\n  const nowLoadingContext = useNowLoadingContext();\n  const navigate = useNavigate();\n\n  React.useEffect(() => {\n    console.log(status);\n    switch (status) {\n      case STATUS.INIT:\n        nowLoadingContext.setNowLoading(true);\n        init();\n        break;\n      case STATUS.START:\n        handleProc();\n        break;\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [status]);\n\n  const init = async () => {\n    if (status === STATUS.INIT) {\n      // 設定の読み込み\n      settingsContext.setSettings(await Settings.load());\n\n      // DIDの読み込み\n      const didModel = await DidTool.load();\n      if (didModel) {\n        didContext.setDidModel(didModel);\n      }\n      setStatus(STATUS.START);\n    };\n  };\n\n  const handleProc = async () => {\n    //setStatus(STATUS.START);\n    if (param) {\n      // 設定の読み込み\n      settingsContext.setSettings(await Settings.load());\n\n      // DIDの読み込み\n      const didModel = await DidTool.load();\n      if (didModel) {\n        didContext.setDidModel(didModel);\n      }\n\n      const requestUrl = base64url.decode(param);\n      if (requestUrl.indexOf('openid://vc/') === 0) {\n        procVc(requestUrl);\n        return\n      }\n      if (requestUrl.indexOf('openid://vc2/') === 0) {\n        issueVc2(requestUrl);\n        return\n      }\n      if (requestUrl.indexOf('openid://vc3/') === 0) {\n        verifyVc2(requestUrl);\n        return\n      }\n      if (requestUrl.indexOf('openidres://vc2/') === 0) {\n        resVc2(requestUrl);\n        return\n      }\n    }\n    \n    navigate('/');\n  };\n\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    switch (e.target.id) {\n      case 'input-pin':\n        setInputPin(() => e.target.value)\n        break;\n    }\n  };\n\n  const issueVc2 = async (requestUrl: string) => {\n    const parsed = QueryString.parseUrl(requestUrl);\n    const url = new URL(parsed.query.request_uri as string);\n    url.searchParams.append('response_type', 'code');\n    url.searchParams.append('client_id', 'xxx');\n    url.searchParams.append('scope', 'idToken');\n    url.searchParams.append('nonce', 'xxx');\n    url.searchParams.append('redirect_uri', `${window.location.origin}/openid/` + base64url.encode('openidres://vc2/#' + url.origin));\n    url.searchParams.append('authorization_details', JSON.stringify({\n      'type': 'openid_credential', \n      'credential_type':'https://ssird-issuer.com/nameCard', \n      'format':'jwt_vc'\n    }))\n    window.location.href = url.toString();\n  };\n\n  const resVc2 = async (requestUrl: string) => {\n    if (!settingsContext.settings) {\n      return\n    }\n    if (!didContext.didModel) {\n      return\n    }\n  \n    try {\n      const issuerOrigin = requestUrl.split('#')[1];\n\n      const query = new URLSearchParams(search);\n\n      const resToken = await fetch(`${issuerOrigin}/token`, {\n        method: 'POST',\n        mode: 'cors',\n        cache: 'no-cache',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          grant_type: 'suthorization_code',\n          client_id: 'xxx',\n          client_secret: 'yyy',\n          code: query.get('code')\n        }),\n      });\n      const tokenObj = await resToken.json();\n      console.log(tokenObj);\n\n      // 自身の公開鍵を取得\n      //const didInfo = await DidTool.resolve(settingsContext.settings.urlResolve, didContext.didModel.did);\n      const now = Math.floor(Date.now() / 1000);\n\n      const reqVc = {\n        header: {\n          alg: 'ES256K',\n          typ: 'JWT',\n          kid: didContext.didModel.kid\n        },\n        payload: {\n          iss: 'xxx',\n          aud: 'https://ssird-issuer.com',\n          iat: now,\n          exp: now + 600,\n          nonce: tokenObj.nonce\n        }\n      };\n\n      console.log(reqVc);\n\n      // 秘密鍵で署名\n      const privateKeyModel = await PrivateKeyTool.load(didContext.didModel.signingKeyId);\n      const reqVcJws = await VerifiableTool.signJws(reqVc.header, reqVc.payload, privateKeyModel?.privateKey);\n\n      const resVc = await fetch(`${issuerOrigin}/vc`, {\n        method: 'POST',\n        mode: 'cors',\n        cache: 'no-cache',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${tokenObj.access_token}`\n        },\n        body: JSON.stringify({\n          proof_type: 'jwt',\n          jwt: reqVcJws\n        }),\n      });\n      const vcObj = await resVc.json();\n      console.log(vcObj);\n\n      const jwt = VerifiableTool.decodeJws(vcObj.credential);\n      console.log(jwt);\n\n      // 署名検証\n      if (! await VerifiableTool.verifyJwsByDid(jwt, settingsContext.settings.urlResolve)) {\n        throw new Error('verifyJwsByDid NG: CredentialOffer');\n      };\n      console.log('verifyJwsByDid OK');\n\n      // VCの保存\n      await VcTool.save(jwt);\n\n      setStatus(STATUS.SIOP_VC_RECEIVED);\n    } catch (e: any) {\n      console.error(e);\n      alert(e.message || e);\n    };\n\n    setTimeout(() => {\n      nowLoadingContext.setNowLoading(false);\n    }, 300);\n\n  };\n\n  const verifyVc2 = async (requestUrl: string) => {\n    try {\n      nowLoadingContext.setNowLoading(true);\n\n      if (!settingsContext.settings) {\n        throw new Error('Not initialized');\n      };\n\n      const parsed = QueryString.parseUrl(requestUrl);\n      const jwt = VerifiableTool.decodeJws(parsed.query.request as string);\n      console.log(jwt);\n\n      // 署名検証\n      if (! await VerifiableTool.verifyJwsByDid(jwt, settingsContext.settings.urlResolve)) {\n        // throw new Error('verifyJwsByDid NG: CredentialOffer');\n        alert('verifyJwsByDid NG');\n      };\n      console.log('verifyJwsByDid OK');\n\n      // 2. 対象のVCを抽出\n      const vcList = await VcTool.all();\n      if (!vcList.length) {\n        throw Error('VC not found.')\n      }\n\n      // 情報を一時保存\n      setVpProcess({\n        credentialOffer: jwt,\n        vcList: vcList\n      });\n      setStatus(STATUS.SIOP_VP2_CONFIRM);\n    } catch (e: any) {\n      console.error(e);\n      alert(e.message || e);\n    };\n    \n    // ここで内容をユーザーに提示し、確認を行う\n    setTimeout(() => {\n      nowLoadingContext.setNowLoading(false);\n    }, 300);\n  };\n\n  const getCredentialOffer = async (url: string) => {\n    if (!settingsContext.settings) {\n      throw new Error('Not initialized');\n    };\n\n    // 取得\n    const parsed = QueryString.parseUrl(url);\n    const response = await fetch(parsed.query.request_uri as string);\n    const body = await response.text();\n    const jwt = VerifiableTool.decodeJws(body);\n    console.log(jwt);\n\n    // 署名検証\n    if (! await VerifiableTool.verifyJwsByDid(jwt, settingsContext.settings.urlResolve)) {\n      throw new Error('verifyJwsByDid NG: CredentialOffer');\n    };\n    console.log('verifyJwsByDid OK');\n\n    return jwt;\n  };\n\n  const getVCExpert = async (url: string) => {\n    if (!settingsContext.settings) {\n      throw new Error('Not initialized');\n    };\n\n    const response = await fetch(url);\n    const resJson = await response.json();\n    const jwt = VerifiableTool.decodeJws(resJson.token);\n    console.log(jwt);\n\n    // 署名検証\n    if (! await VerifiableTool.verifyJwsByDid(jwt, settingsContext.settings.urlResolve)) {\n      throw new Error('verifyJwsByDid NG: CredentialOffer');\n    };\n    console.log('verifyJwsByDid OK');\n\n    return jwt;\n  };\n\n  const procVc = async (requestUrl: string) => {\n    if (requestUrl.indexOf('openid://vc/') !== 0) {\n      alert('openid://vc/ 形式のみ有効です')\n      return;\n    };\n\n    try {\n      nowLoadingContext.setNowLoading(true);\n\n      // 1. オファーリクエストを取得(Issure/Verifier→HolderへのSIOP Request)\n      const credentialOffer = await getCredentialOffer(requestUrl);\n\n      if (credentialOffer.payload.prompt && credentialOffer.payload.prompt === 'create') {\n        issueVc(credentialOffer);\n      } else {\n        verifyVc(credentialOffer);\n      }\n    } catch (e: any) {\n      console.error(e);\n      alert(e.message || e);\n      nowLoadingContext.setNowLoading(false);\n    };\n  }\n\n  const verifyVc = async (credentialOffer: JWTObject) => {\n    try {\n\n      // 2. 対象のVCを抽出\n      const vcList = await VcTool.all();\n      if (!vcList.length) {\n        throw Error('VC not found.')\n      }\n\n      // 情報を一時保存\n      setVpProcess({\n        credentialOffer: credentialOffer,\n        vcList: vcList\n      });\n      setStatus(STATUS.SIOP_VP_CONFIRM);\n    } catch (e: any) {\n      console.error(e);\n      alert(e.message || e);\n    };\n\n    // ここで内容をユーザーに提示し、確認を行う\n    setTimeout(() => {\n      nowLoadingContext.setNowLoading(false);\n    }, 300);\n  }\n\n  const issueVc = async (credentialOffer: JWTObject) => {\n    try {\n\n      // 2. オファーリクエストの検証\n      const manifestUrl = credentialOffer.payload.claims.vp_token.presentation_definition.input_descriptors[0].issuance[0].manifest2;\n      const vcExpert = await getVCExpert(manifestUrl);\n\n      // 情報を一時保存\n      setVcProcess({\n        credentialOffer: credentialOffer,\n        vcExpert: vcExpert\n      });\n      setStatus(STATUS.SIOP_VC_CONFIRM);\n    } catch (e: any) {\n      console.error(e);\n      alert(e.message || e);\n    };\n\n    // ここで内容をユーザーに提示し、確認を行う\n    setTimeout(() => {\n      nowLoadingContext.setNowLoading(false);\n    }, 300);\n  }\n\n  const addVC = async () => {\n    if (!settingsContext.settings) {\n      return\n    }\n    if (!didContext.didModel) {\n      return\n    }\n\n    // 3. レスポンス(Holder→IssureへのSIOP Response)\n\n    try {\n      nowLoadingContext.setNowLoading(true);\n\n      // 自身の公開鍵を取得\n      const didInfo = await DidTool.resolve(settingsContext.settings.urlResolve, didContext.didModel.did);\n      const now = Math.floor(Date.now() / 1000);\n\n      const credentialRequest = {\n        header: {\n          alg: 'ES256K',\n          typ: 'JWT',\n          kid: didContext.didModel.kid\n        },\n        payload: {\n          iss: 'https://self-issued.me',\n          aud: vcProcess.vcExpert.payload.input.credentialIssuer,\n          contract: vcProcess.vcExpert.payload.display.contract,\n          iat: now,\n          exp: now + 600,\n          sub_jwk: JSON.parse(JSON.stringify(didInfo.didDocument.verificationMethod[0].publicKeyJwk)),\n          sub: VerifiableTool.generateSub(didInfo.didDocument.verificationMethod[0].publicKeyJwk),\n          jti: uuid.v4(),\n          did: didContext.didModel.did,\n          pin: VerifiableTool.generateHash(inputPin),\n          attestations: {\n            idTokens: {\n              'https://self-issued.me': vcProcess.credentialOffer.payload.id_token_hint\n            }\n          }\n        }\n      };\n\n      // To Micfosoft向けの置換\n      if (credentialRequest.payload.aud.indexOf('/api/issuer/card') > -1) {\n        credentialRequest.payload.aud = 'https://beta.did.msidentity.com/v1.0/f55d947c-0f8e-48d7-b1ea-b7f5c99291ce/verifiableCredential/card/issue';\n      };\n\n      console.log(credentialRequest);\n\n      // 秘密鍵で署名\n      const privateKeyModel = await PrivateKeyTool.load(didContext.didModel.signingKeyId);\n      const credentialRequestJws = await VerifiableTool.signJws(credentialRequest.header, credentialRequest.payload, privateKeyModel?.privateKey);\n      //console.log(credentialRequestJws);\n\n      const response = await fetch(vcProcess.vcExpert.payload.input.credentialIssuer, {\n        method: 'POST',\n        mode: 'cors',\n        cache: 'no-cache',\n        body: credentialRequestJws,\n      });\n\n      if (response.status !== 200) {\n        throw Error(await response.text());\n      }\n\n      const resJson = await response.json();\n      const jwt = VerifiableTool.decodeJws(resJson.vc);\n      console.log(jwt);\n\n      // 署名検証\n      if (! await VerifiableTool.verifyJwsByDid(jwt, settingsContext.settings.urlResolve)) {\n        throw new Error('verifyJwsByDid NG: CredentialOffer');\n      };\n      console.log('verifyJwsByDid OK');\n\n      // VCの保存\n      await VcTool.save(jwt);\n\n      setStatus(STATUS.SIOP_VC_RECEIVED);\n    } catch (e: any) {\n      console.error(e);\n      alert(e.message || e);\n    };\n\n    setTimeout(() => {\n      nowLoadingContext.setNowLoading(false);\n    }, 300);\n  };\n\n  const sendVP = async () => {\n    if (!settingsContext.settings) {\n      return\n    }\n    if (!didContext.didModel) {\n      return\n    }\n\n    // 3. レスポンス(Holder→VerifierへのSIOP Response)\n\n    try {\n      nowLoadingContext.setNowLoading(true);\n\n      const now = Math.floor(Date.now() / 1000);\n\n      const idToken = {\n        header: {\n          alg: 'ES256K',\n          typ: 'JWT',\n          kid: didContext.didModel.kid\n        },\n        payload: {\n          iss: 'https://self-issued.me/v2/openid-vc',\n          aud: vpProcess.credentialOffer.payload.client_id,\n          sub: didContext.didModel.did,\n          iat: now,\n          exp: now + 600,\n          nonce: vpProcess.credentialOffer.payload.nonce,\n          _vp_token: {\n            presentation_submission: {\n              id: uuid.v4(),\n              definition_id: uuid.v4(),\n              descriptor_map: [\n                {\n                  id: 'VerifiedCredentialExpert',\n                  format: 'jwt_vp',\n                  path: '$',\n                  'path_nested': {\n                    id: 'VerifiedCredentialExpert',\n                    format: 'jwt_vc',\n                    path: '$.verifiableCredential[0]'\n                  }\n                }\n              ]\n            }\n          }\n        }\n      };\n\n      console.log(idToken);\n\n      // 秘密鍵で署名\n      const privateKeyModel = await PrivateKeyTool.load(didContext.didModel.signingKeyId);\n      const idTokenJws = await VerifiableTool.signJws(idToken.header, idToken.payload, privateKeyModel?.privateKey);\n\n      const vpToken = {\n        header: {\n          alg: 'ES256K',\n          typ: 'JWT',\n          kid: didContext.didModel.kid\n        },\n        payload: {\n          iss: didContext.didModel.did,\n          aud: vpProcess.credentialOffer.payload.client_id,\n          iat: now,\n          nbf: now,\n          exp: now + 600,\n          nonce: vpProcess.credentialOffer.payload.nonce,\n          vp: {\n            '@context': [\n              'https://www.w3.org/2018/credentials/v1'\n            ],\n            type: [\n              'VerifiablePresentation'\n            ],\n            verifiableCredential: [\n              vpProcess.vcList[0].vc.jws\n            ]\n          }\n        }\n      };\n\n      console.log(vpToken);\n\n      // 秘密鍵で署名\n      //const privateKeyModel = await PrivateKeyTool.load(didContext.didModel.signingKeyId);\n      const vpTokenJws = await VerifiableTool.signJws(vpToken.header, vpToken.payload, privateKeyModel?.privateKey);\n\n      const params = new URLSearchParams();\n      params.append('id_token', idTokenJws);\n      params.append('vp_token', vpTokenJws);\n      params.append('state', vpProcess.credentialOffer.payload.state);\n\n      const response = await fetch(vpProcess.credentialOffer.payload.redirect_uri, {\n        method: 'POST',\n        mode: 'cors',\n        cache: 'no-cache',\n        body: params,\n      });\n\n      if (response.status !== 200) {\n        throw Error(await response.text());\n      }\n\n      setStatus(STATUS.SIOP_VP_VERIFIED);\n    } catch (e: any) {\n      console.error(e);\n      alert(e.message || e);\n    };\n\n    setTimeout(() => {\n      nowLoadingContext.setNowLoading(false);\n    }, 300);\n  };\n\n  const sendVP2 = async () => {\n    if (!settingsContext.settings) {\n      return\n    }\n    if (!didContext.didModel) {\n      return\n    }\n\n    // 3. レスポンス(Holder→VerifierへのSIOP Response)\n\n    try {\n      nowLoadingContext.setNowLoading(true);\n\n      // 自身の公開鍵を取得\n      const didInfo = await DidTool.resolve(settingsContext.settings.urlResolve, didContext.didModel.did);\n      const now = Math.floor(Date.now() / 1000);\n\n      const idToken = {\n        header: {\n          alg: 'ES256K',\n          typ: 'JWT',\n          kid: didContext.didModel.kid\n        },\n        payload: {\n          iss: 'https://self-issued.me/v2',\n          aud: vpProcess.credentialOffer.payload.client_id,\n          sub: VerifiableTool.generateSub(didInfo.didDocument.verificationMethod[0].publicKeyJwk),\n          sub_jwk: JSON.parse(JSON.stringify(didInfo.didDocument.verificationMethod[0].publicKeyJwk)),\n          iat: now,\n          exp: now + 600,\n          auth_time: now,\n          nonce: vpProcess.credentialOffer.payload.nonce,\n          _vp_token: {\n            presentation_submission: {\n              id: uuid.v4(),\n              definition_id: uuid.v4(),\n              descriptor_map: [\n                {\n                  id: 'VerifiedCredentialExpert',\n                  format: 'ldp_vp',\n                  path: '$',\n                  path_nested: {\n                    format: 'ldp_vc',\n                    path: '$.verifiableCredential[0]'\n                  }\n                }\n              ]\n            }\n          }\n        }\n      };\n\n      console.log(idToken);\n\n      // 秘密鍵で署名\n      const privateKeyModel = await PrivateKeyTool.load(didContext.didModel.signingKeyId);\n      const idTokenJws = await VerifiableTool.signJws(idToken.header, idToken.payload, privateKeyModel?.privateKey);\n\n      const vpToken = {\n        header: {\n          alg: 'ES256K',\n          typ: 'JWT',\n          kid: didContext.didModel.kid\n        },\n        payload: {\n          '@context': [\n            'https://www.w3.org/2018/credentials/v1'\n          ],\n          type: [\n            'VerifiablePresentation'\n          ],\n          verifiableCredential: [\n            vpProcess.vcList[0].vc.payload\n          ],\n          id: 'ebc6f1c2',\n          holder: didContext.didModel.did,\n          proof: {\n            type: \"Ed25519Signature2018\",\n            created: new Date().toISOString(),\n            challenge: vpProcess.credentialOffer.payload.nonce,\n            domain: vpProcess.credentialOffer.payload.client_id,\n            jws: vpProcess.vcList[0].vc.jws,\n            proofPurpose: 'authentication',\n            verificationMethod: didContext.didModel.kid\n          }\n        }\n      };\n\n      console.log(vpToken);\n\n      // 秘密鍵で署名\n      //const privateKeyModel = await PrivateKeyTool.load(didContext.didModel.signingKeyId);\n      const vpTokenJws = await VerifiableTool.signJws(vpToken.header, vpToken.payload, privateKeyModel?.privateKey);\n\n      const params = new URLSearchParams();\n      params.append('id_token', idTokenJws);\n      params.append('vp_token', vpTokenJws);\n      params.append('state', vpProcess.credentialOffer.payload.state);\n\n      const response = await fetch(vpProcess.credentialOffer.payload.client_id, {\n        method: 'POST',\n        mode: 'cors',\n        cache: 'no-cache',\n        body: params,\n      });\n\n      if (response.status !== 200) {\n        throw Error(await response.text());\n      }\n\n      setStatus(STATUS.SIOP_VP2_VERIFIED);\n    } catch (e: any) {\n      console.error(e);\n      alert(e.message || e);\n    };\n\n    setTimeout(() => {\n      nowLoadingContext.setNowLoading(false);\n    }, 300);\n  };\n\n  if (status === STATUS.SIOP_VC_RECEIVED) {\n    return (\n      <Container maxWidth='sm' sx={{ paddingX: '8px' }}>\n        <Typography variant='h5' sx={{ marginBottom: '16px' }}>\n          VC受け取り完了\n        </Typography>\n        <Typography>\n          VCをウォレットに登録しました。\n        </Typography>\n      </Container>\n    );\n  }\n\n  if (status === STATUS.SIOP_VC_CONFIRM) {\n    return (\n      <Container maxWidth='sm' sx={{ paddingX: '8px' }}>\n        <Typography variant='h5' sx={{ marginBottom: '16px' }}>\n          VC発行確認\n        </Typography>\n        <Card sx={{ bgcolor: vcProcess.vcExpert.payload.display.card.backgroundColor, maxWidth: '360px', marginX: 'auto' }}>\n          <CardHeader\n            avatar={<Avatar src={vcProcess.vcExpert.payload.display.card.logo.uri} />}\n            title={vcProcess.vcExpert.payload.display.card.title}\n            sx={{ color: vcProcess.vcExpert.payload.display.card.textColor }}\n          />\n          <CardContent>\n            <Typography sx={{ color: vcProcess.vcExpert.payload.display.card.textColor }}>\n              <br />\n              Microsoft\n            </Typography>\n          </CardContent>\n        </Card>\n        <Typography sx={{ marginTop: '16px' }}>{vcProcess.vcExpert.payload.display.consent.title}</Typography>\n        <TextField id='input-pin' label='PIN' fullWidth sx={{ marginTop: '16px' }} inputProps={{ inputMode: 'numeric', pattern: '[0-9]*' }}\n          value={inputPin} onChange={handleChange}\n        />\n        <Grid container spacing={2} sx={{ marginTop: '16px' }}>\n          <Grid item xs={6}>\n            <Button variant='outlined' fullWidth onClick={() => navigate('/')}>キャンセル</Button>\n          </Grid>\n          <Grid item xs={6}>\n            <Button variant='contained' fullWidth onClick={addVC}>追加</Button>\n          </Grid>\n        </Grid>\n      </Container>\n    );\n  }\n\n  if (status === STATUS.SIOP_VP_CONFIRM) {\n    return (\n      <Container maxWidth='sm' sx={{ paddingX: '8px' }}>\n        <Typography variant='h5' sx={{ marginBottom: '16px' }}>\n          VC提示確認\n        </Typography>\n        <Card variant='outlined'>\n          <CardContent>\n            <Typography sx={{ marginBottom: '16px' }}>\n              提示条件\n            </Typography>\n            <TextField\n              label='input_descriptors'\n              fullWidth\n              multiline\n              maxRows={8}\n              value={JSON.stringify(vpProcess.credentialOffer.payload.claims.vp_token.presentation_definition.input_descriptors, null, 2)}\n              InputProps={{\n                readOnly: true,\n                sx: {fontSize: '12px'}\n              }}\n            />\n          </CardContent>\n        </Card>\n        <Typography sx={{ marginTop: '16px' }}>\n          \n        </Typography>\n        <Grid container spacing={2} sx={{ marginTop: '16px' }}>\n          <Grid item xs={6}>\n            <Button variant='outlined' fullWidth onClick={() => navigate('/')}>キャンセル</Button>\n          </Grid>\n          <Grid item xs={6}>\n            <Button variant='contained' fullWidth onClick={sendVP}>提示</Button>\n          </Grid>\n        </Grid>\n      </Container>\n    );\n  };\n\n  if (status === STATUS.SIOP_VP2_CONFIRM) {\n    return (\n      <Container maxWidth='sm' sx={{ paddingX: '8px' }}>\n        <Typography variant='h5' sx={{ marginBottom: '16px' }}>\n          VC提示確認\n        </Typography>\n        <Card variant='outlined'>\n          <CardContent>\n            <Typography sx={{ marginBottom: '16px' }}>\n              提示条件\n            </Typography>\n            <TextField\n              label='input_descriptors'\n              fullWidth\n              multiline\n              maxRows={8}\n              value={JSON.stringify(vpProcess.credentialOffer.payload.presentation_definition.input_descriptors, null, 2)}\n              InputProps={{\n                readOnly: true,\n                sx: {fontSize: '12px'}\n              }}\n            />\n          </CardContent>\n        </Card>\n        <Typography sx={{ marginTop: '16px' }}>\n          \n        </Typography>\n        <Grid container spacing={2} sx={{ marginTop: '16px' }}>\n          <Grid item xs={6}>\n            <Button variant='outlined' fullWidth onClick={() => navigate('/')}>キャンセル</Button>\n          </Grid>\n          <Grid item xs={6}>\n            <Button variant='contained' fullWidth onClick={sendVP2}>提示</Button>\n          </Grid>\n        </Grid>\n      </Container>\n    );\n  };\n\n  if (status === STATUS.SIOP_VP_VERIFIED || status === STATUS.SIOP_VP2_VERIFIED) {\n    return (\n      <Container maxWidth='sm' sx={{ paddingX: '8px' }}>\n        <Typography variant='h5' sx={{ marginBottom: '16px' }}>\n          VC提示完了\n        </Typography>\n        <Typography>\n          VCの提示が完了しました。\n        </Typography>\n      </Container>\n    );\n  }\n\n  return (\n    <Container maxWidth='sm' sx={{ paddingX: '8px' }}>\n      <Typography variant='h5' sx={{ marginBottom: '16px' }}>\n        Loading . . .\n      </Typography>\n    </Container>\n  );\n}","import * as React from 'react';\nimport { Typography, Container, Grid, Button, TextField, Snackbar, Alert, Checkbox, FormControlLabel } from '@mui/material';\nimport { Save as IconSave } from '@mui/icons-material'\n\nimport { Settings } from '../helpers/settings';\nimport { useSettingsContext } from '../layout/sideMenuLayout';\n\nexport const PageSettings = () => {\n  const settingsContext = useSettingsContext();\n\n  const [open, setOpen] = React.useState(false);\n  const [urlOperation, setUrlOperation] = React.useState('');\n  const [urlResolve, setUrlResolve] = React.useState('');\n  const [needChallenge, setNeedChallenge] = React.useState(true);\n\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    switch (e.target.id) {\n      case 'url-operation':\n        setUrlOperation(() => e.target.value);\n        break;\n      case 'url-resolve':\n        setUrlResolve(() => e.target.value);\n        break;\n      case 'need-challenge':\n        setNeedChallenge(() => e.target.checked);\n        break;\n    }\n  };\n\n  const handleOpen = () => {\n    setOpen(true);\n  };\n\n  const handleClose = (event?: React.SyntheticEvent | Event, reason?: string) => {\n    if (reason === 'clickaway') {\n      return;\n    }\n    setOpen(false);\n  };\n\n  const saveSettings = async () => {\n    // 設定の保存\n    const settings = new Settings();\n    settings.urlOperation = urlOperation;\n    settings.urlResolve = urlResolve;\n    settings.needChallenge = needChallenge;\n    await settings.save();\n    settingsContext.setSettings(settings);\n    \n    handleOpen();\n  };\n\n  const resetSettings = async () => {\n    await Settings.clear();\n    const settings = new Settings();\n    settingsContext.setSettings(settings);\n    setUrlOperation(settings.urlOperation);\n    setUrlResolve(settings.urlResolve);\n    setNeedChallenge(settings.needChallenge);\n  };\n\n  React.useEffect(() => {\n    // 設定の読み込み\n    Settings.load().then((settings) => {\n      setUrlOperation(settings.urlOperation);\n      setUrlResolve(settings.urlResolve);\n      setNeedChallenge(settings.needChallenge);\n    });\n    return () => {\n      \n    };\n  },[])\n\n  return (\n    <>\n      <Container maxWidth='sm' sx={{paddingX: '8px'}}>\n        <Typography variant='h5' sx={{marginBottom: '16px'}}>\n          Settings\n        </Typography>\n        <Grid container spacing={2}>\n          <Grid item xs={12}>\n            <TextField id='url-operation' fullWidth label='Operation URL' variant='outlined' value={urlOperation} onChange={handleChange} />\n          </Grid>\n          <Grid item xs={12}>\n            <FormControlLabel control={<Checkbox id='need-challenge' checked={needChallenge} onChange={handleChange} />} label=\"Need Challenge\" />\n          </Grid>\n          <Grid item xs={12}>\n            <TextField id='url-resolve' fullWidth label='Resolve URL' variant='outlined' value={urlResolve} onChange={handleChange} />\n          </Grid>\n          <Grid item xs={8}>\n            <Button fullWidth variant='contained' startIcon={<IconSave />} onClick={saveSettings}>保存</Button>\n          </Grid>\n          <Grid item xs={4}>\n            <Button fullWidth variant='contained' color='error' onClick={resetSettings}>リセット</Button>\n          </Grid>\n        </Grid>\n      </Container>\n      <Snackbar open={open} autoHideDuration={6000} onClose={handleClose}>\n        <Alert onClose={handleClose} severity=\"success\" sx={{ width: '100%' }}>\n          設定を保存しました。\n        </Alert>\n      </Snackbar>\n    </>\n  );\n}","import { BrowserRouter, Routes, Route } from \"react-router-dom\";\nimport './App.css';\nimport { SideMenuLayout } from './layout/sideMenuLayout';\nimport { PageTop } from './pages/top';\nimport { PageQr } from './pages/qr';\nimport { PageDid } from './pages/did';\nimport { PageVc } from './pages/vc';\nimport { PageOpenid } from './pages/openid';\nimport { PageSettings } from './pages/settings';\n\nconst App = () => {\n  return <BrowserRouter>\n    <Routes>\n      <Route element={<SideMenuLayout />}>\n        <Route index element={<PageTop />} />\n        <Route path='qr' element={<PageQr />} />\n        <Route path='did' element={<PageDid />} />\n        <Route path='vc' element={<PageVc />} />\n        <Route path='openid/:param' element={<PageOpenid />} />\n\n        <Route path='settings' element={<PageSettings />} />\n      </Route>\n    </Routes>\n  </BrowserRouter>;\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://cra.link/PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(/^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://cra.link/PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then((registration) => {\n      registration.onupdatefound = () => {\n        // 以下3行を追加\n        if (registration.waiting && config && config.onUpdate) {\n          config.onUpdate(registration);\n        }\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://cra.link/PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          } else if (installingWorker.state === 'activated') {\n            window.location.reload();\n          }\n        };\n      };\n    })\n    .catch((error) => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then((response) => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then((registration) => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log('No internet connection found. App is running in offline mode.');\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then((registration) => {\n        registration.unregister();\n      })\n      .catch((error) => {\n        console.error(error.message);\n      });\n  }\n}\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React, { useState } from 'react';\nimport { Button, Dialog, DialogTitle, DialogContent, DialogActions, DialogContentText} from '@mui/material';\n\nexport const SWUpdateDialog: React.FC<{ registration: ServiceWorkerRegistration }> = ({ registration }) => {\n  const [show, setShow] = useState(!!registration.waiting);\n  const handleUpdate = () => {\n    registration.waiting?.postMessage({ type: 'SKIP_WAITING' });\n    setShow(false);\n    //window.location.reload();\n  };\n\n  return (\n    <Dialog open={show}>\n      <DialogTitle style={{textAlign: \"center\"}}>\n        アップデート通知\n      </DialogTitle>\n      <DialogContent>\n        <DialogContentText>\n          新しいバージョンがリリースされました。\n        </DialogContentText>\n      </DialogContent>\n      <DialogActions sx={{justifyContent: \"center\"}}>\n        <Button onClick={handleUpdate}>アップデート</Button>\n      </DialogActions>\n    </Dialog>\n  );\n};","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorkerRegistration from './serviceWorkerRegistration';\nimport reportWebVitals from './reportWebVitals';\nimport { SWUpdateDialog } from './ServiceWorkerUpdateDialog';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://cra.link/PWA\n//serviceWorkerRegistration.unregister();\nserviceWorkerRegistration.register({\n  onUpdate: registration => {\n    if (registration.waiting) {\n      ReactDOM.render(<SWUpdateDialog registration={registration} />, document.querySelector('.SW-update-dialog'));\n    }\n  },\n});\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}