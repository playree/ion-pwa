(this["webpackJsonpion-pwa"]=this["webpackJsonpion-pwa"]||[]).push([[0],{260:function(e,t,n){},261:function(e,t,n){},272:function(e,t){},274:function(e,t){},285:function(e,t){},287:function(e,t){},314:function(e,t){},315:function(e,t){},321:function(e,t){},340:function(e,t){},409:function(e,t,n){"use strict";n.r(t);var r=n(1),a=n.n(r),i=n(54),c=n.n(i),s=(n(260),n(44)),o=n(18),u=(n(261),n(11)),d=n(77),l=n(4),p=n(33),x=n(492),j=n(457),b=n(493),f=n(494),h=n(419),O=n(484),v=n(496),g=n(497),y=n(479),m=n(498),w=n(499),k=n(495),S=n(500),E=n(490),D=n(458),C=n(461),I=n(462),R=n(463),N=n(464),_=n(465),P=n(466),K=n(467),L=n(0),T=200,M=Object(l.a)("main",{shouldForwardProp:function(e){return"open"!==e}})((function(e){var t=e.theme,n=e.open;return Object(d.a)({flexGrow:1,padding:t.spacing(3),transition:t.transitions.create("margin",{easing:t.transitions.easing.sharp,duration:t.transitions.duration.leavingScreen}),marginLeft:"-".concat(T,"px")},n&&{transition:t.transitions.create("margin",{easing:t.transitions.easing.easeOut,duration:t.transitions.duration.enteringScreen}),marginLeft:0})})),W=Object(l.a)(E.a,{shouldForwardProp:function(e){return"open"!==e}})((function(e){var t=e.theme,n=e.open;return Object(d.a)({transition:t.transitions.create(["margin","width"],{easing:t.transitions.easing.sharp,duration:t.transitions.duration.leavingScreen})},n&&{width:"calc(100% - ".concat(T,"px)"),marginLeft:"".concat(T,"px"),transition:t.transitions.create(["margin","width"],{easing:t.transitions.easing.easeOut,duration:t.transitions.duration.enteringScreen})})})),J=Object(l.a)("div")((function(e){var t=e.theme;return Object(d.a)(Object(d.a)({display:"flex",alignItems:"center",padding:t.spacing(0,1)},t.mixins.toolbar),{},{justifyContent:"flex-end"})})),B={textDecorationLine:"none",color:"#444",fontWeight:"bold"},A=r.createContext({}),U=function(){return r.useContext(A)},V=r.createContext({}),z=function(){return r.useContext(V)},F=r.createContext({}),H=function(){return r.useContext(F)},q=function(){var e=Object(p.a)(),t=r.useState(!1),n=Object(u.a)(t,2),a=n[0],i=n[1],c=r.useState(!1),l=Object(u.a)(c,2),E=l[0],U=l[1],z=r.useState(null),H=Object(u.a)(z,2),q=H[0],X=H[1],Y=r.useState(null),G=Object(u.a)(Y,2),$=function(){i(!1)},Q={isNowLoading:E,setNowLoading:U},Z={settings:q,setSettings:X},ee={didModel:G[0],setDidModel:G[1]};return Object(L.jsxs)(x.a,{sx:{display:"flex"},children:[Object(L.jsx)(j.a,{}),Object(L.jsx)(W,{position:"fixed",open:a,children:Object(L.jsxs)(b.a,{sx:{minHeight:"40px"},children:[Object(L.jsx)(f.a,{color:"inherit","aria-label":"open drawer",onClick:function(){i(!0)},edge:"start",sx:Object(d.a)({mr:2},a&&{display:"none"}),children:Object(L.jsx)(D.a,{})}),Object(L.jsx)(h.a,{variant:"h6",noWrap:!0,component:"div",children:"ION PWA Sample"})]})}),Object(L.jsxs)(O.a,{sx:{width:T,flexShrink:0,"& .MuiDrawer-paper":{width:T,boxSizing:"border-box"}},variant:"persistent",anchor:"left",open:a,children:[Object(L.jsx)(J,{children:Object(L.jsx)(f.a,{onClick:$,children:"ltr"===e.direction?Object(L.jsx)(C.a,{}):Object(L.jsx)(I.a,{})})}),Object(L.jsx)(v.a,{}),Object(L.jsxs)(g.a,{children:[Object(L.jsx)(s.b,{to:"/",style:B,onClick:$,children:Object(L.jsxs)(y.a,{button:!0,children:[Object(L.jsx)(m.a,{sx:{minWidth:"40px"},children:Object(L.jsx)(R.a,{})}),Object(L.jsx)(w.a,{primary:"\u30c8\u30c3\u30d7"})]})}),Object(L.jsx)(s.b,{to:"/qr/",style:B,onClick:$,children:Object(L.jsxs)(y.a,{button:!0,children:[Object(L.jsx)(m.a,{sx:{minWidth:"40px"},children:Object(L.jsx)(N.a,{})}),Object(L.jsx)(w.a,{primary:"QR\u8aad\u307f\u8fbc\u307f"})]})}),Object(L.jsx)(s.b,{to:"/did/",style:B,onClick:$,children:Object(L.jsxs)(y.a,{button:!0,children:[Object(L.jsx)(m.a,{sx:{minWidth:"40px"},children:Object(L.jsx)(_.a,{})}),Object(L.jsx)(w.a,{primary:"DID\u8a73\u7d30"})]})}),Object(L.jsx)(s.b,{to:"/vc/",style:B,onClick:$,children:Object(L.jsxs)(y.a,{button:!0,children:[Object(L.jsx)(m.a,{sx:{minWidth:"40px"},children:Object(L.jsx)(P.a,{})}),Object(L.jsx)(w.a,{primary:"VC\u4e00\u89a7"})]})})]}),Object(L.jsx)(v.a,{}),Object(L.jsx)(g.a,{children:Object(L.jsx)(s.b,{to:"/settings/",style:B,onClick:$,children:Object(L.jsxs)(y.a,{button:!0,children:[Object(L.jsx)(m.a,{sx:{minWidth:"40px"},children:Object(L.jsx)(K.a,{})}),Object(L.jsx)(w.a,{primary:"\u8a2d\u5b9a"})]})})}),Object(L.jsx)(v.a,{}),Object(L.jsx)(g.a,{children:Object(L.jsxs)(y.a,{sx:{fontSize:"14px",color:"gray"},children:["build: ","20220701.001"]})})]}),Object(L.jsx)(A.Provider,{value:Q,children:Object(L.jsx)(V.Provider,{value:Z,children:Object(L.jsxs)(F.Provider,{value:ee,children:[Object(L.jsxs)(M,{onClick:$,sx:{height:"100vh",width:"100%",paddingX:"8px"},children:[Object(L.jsx)(J,{sx:{minHeight:"40px"}}),Object(L.jsx)(o.b,{})]}),Object(L.jsx)(k.a,{sx:{color:"#fff",zIndex:function(e){return e.zIndex.drawer+1}},open:Q.isNowLoading,children:Object(L.jsx)(S.a,{color:"inherit"})})]})})}),Object(L.jsx)("div",{className:"SW-update-dialog"})]})},X=n(6),Y=n(15),G=n(485),$=n(486),Q=n(487),Z=n(480),ee=n(477),te=n(488),ne=n(501),re=n(502),ae=n(474),ie=n(503),ce=n(504),se=n(471),oe=n(505),ue=n(506),de=n(468),le=n(35),pe=n(36),xe=n(236),je=Object(pe.a)((function e(t,n){Object(le.a)(this,e),this.key=void 0,this.value=void 0,this.key=t,this.value=n}));je.KEYS={URL_OPERATION:"URL_OPERATION",URL_RESOLVE:"URL_RESOLVE",NEED_CHALLENGE:"NEED_CHALLENGE"},Object(pe.a)((function e(t,n,r,a,i){Object(le.a)(this,e),this.key=void 0,this.didlong=void 0,this.signingPrivateKey=void 0,this.recoveryPrivateKey=void 0,this.updatePrivateKey=void 0,this.key=t,this.didlong=n,this.signingPrivateKey=r,this.recoveryPrivateKey=a,this.updatePrivateKey=i})).KEY="KEY";var be=new xe.a("ionpwa-db");be.version(2).stores({settings:"key",did:"id",privatekey:"id",vc:"++id"});var fe=function(){function e(){Object(le.a)(this,e),this.urlOperation=void 0,this.urlResolve=void 0,this.needChallenge=void 0,this.urlOperation="https://beta.ion.msidentity.com/api/v1.0/",this.urlResolve="https://beta.discover.did.microsoft.com/1.0/",this.needChallenge=!0}return Object(pe.a)(e,[{key:"load",value:function(){var e=Object(Y.a)(Object(X.a)().mark((function e(){var t,n,r;return Object(X.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,be.settings.get(je.KEYS.URL_OPERATION);case 2:return(t=e.sent)&&(this.urlOperation=t.value),e.next=6,be.settings.get(je.KEYS.URL_RESOLVE);case 6:return(n=e.sent)&&(this.urlResolve=n.value),e.next=10,be.settings.get(je.KEYS.NEED_CHALLENGE);case 10:(r=e.sent)&&(this.needChallenge=r.value);case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"save",value:function(){var e=Object(Y.a)(Object(X.a)().mark((function e(){return Object(X.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,be.settings.put(new je(je.KEYS.URL_OPERATION,this.urlOperation));case 2:return e.next=4,be.settings.put(new je(je.KEYS.URL_RESOLVE,this.urlResolve));case 4:return e.next=6,be.settings.put(new je(je.KEYS.NEED_CHALLENGE,this.needChallenge));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}],[{key:"load",value:function(){var t=Object(Y.a)(Object(X.a)().mark((function t(){var n;return Object(X.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=new e,t.next=3,n.load();case 3:return t.abrupt("return",n);case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()},{key:"clear",value:function(){var e=Object(Y.a)(Object(X.a)().mark((function e(){return Object(X.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,be.settings.clear();case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),e}(),he=n(118),Oe=n(67),ve=n(238),ge=n.n(ve),ye=n(93),me=n(48),we=n(17),ke=n.n(we),Se=n(30),Ee=n(90),De=function(){function e(){Object(le.a)(this,e)}return Object(pe.a)(e,null,[{key:"create",value:function(){var t=Object(Y.a)(Object(X.a)().mark((function t(n,r){var a,i,c,s,o,d,l,p,x,j,b,f,h,O,v,g,y,m,w,k,S,E,D,C,I,R,N,_=arguments;return Object(X.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=_.length>2&&void 0!==_[2]?_[2]:"",i=a||Pe.generateKid(),t.next=4,Oe.IonKey.generateEs256kOperationKeyPair();case 4:return c=t.sent,s=Object(u.a)(c,2),o=s[0],d=s[1],t.next=10,Oe.IonKey.generateEs256kOperationKeyPair();case 10:return l=t.sent,p=Object(u.a)(l,2),x=p[0],j=p[1],t.next=16,Oe.IonKey.generateEs256kDidDocumentKeyPair({id:i});case 16:if(b=t.sent,f=Object(u.a)(b,2),h=f[0],O=f[1],h.purposes=[Oe.IonPublicKeyPurpose.Authentication],v={recoveryKey:o,updateKey:x,document:{publicKeys:[h]}},g=Oe.IonRequest.createCreateRequest(v),y=Oe.IonDid.createLongFormDid(v),m=y.substring(y.lastIndexOf(":")+1),!r){t.next=33;break}return t.next=30,ge.a.submitIonRequest(Object(ye.a)(n,e.ACTION_PATH.PROOF),Object(ye.a)(n,e.ACTION_PATH.OPERATIONS),JSON.stringify(g));case 30:t.t0=t.sent,t.next=36;break;case 33:return t.next=35,e._submitIonRequest(Object(ye.a)(n,e.ACTION_PATH.OPERATIONS),JSON.stringify(g));case 35:t.t0=t.sent;case 36:if(w=t.t0){t.next=39;break}return t.abrupt("return",null);case 39:return k=JSON.parse(w),S=k.didDocument.id,E=S.split(":"),D=E[0],C=E[E.length-1],I=E[1],4===E.length&&(I+=":"+E[2]),R=k.didDocumentMetadata.method.published,N=new Ie(D,I,C,m,i,R),t.abrupt("return",{didModel:N,signingPrivateKey:O,recoveryPrivateKey:d,updatePrivateKey:j});case 51:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"_submitIonRequest",value:function(){var e=Object(Y.a)(Object(X.a)().mark((function e(t,n){var r,a;return Object(X.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(me.fetch)(t,{method:"POST",mode:"cors",body:n,headers:{"Content-Type":"application/json"}});case 2:if(!((r=e.sent).status>=500)){e.next=13;break}return e.t0=console,e.t1="Unexpected 5xx response: ",e.next=8,r.text();case 8:e.t2=e.sent,e.t3=e.t1.concat.call(e.t1,e.t2),e.t0.log.call(e.t0,e.t3),e.next=40;break;case 13:if(!(r.status>=400)){e.next=24;break}return e.t4=console,e.t5="Bed request: ",e.next=18,r.text();case 18:e.t6=e.sent,e.t7=e.t5.concat.call(e.t5,e.t6),e.t4.log.call(e.t4,e.t7),console.log("Retrying with new challenge and difficulty"),e.next=40;break;case 24:if(!(r.status>=300)){e.next=34;break}return e.t8=console,e.t9="Unexpected 3xx response: ",e.next=29,r.text();case 29:e.t10=e.sent,e.t11=e.t9.concat.call(e.t9,e.t10),e.t8.log.call(e.t8,e.t11),e.next=40;break;case 34:return console.log("Successful registration"),e.next=37,r.text();case 37:return a=e.sent,console.log(a),e.abrupt("return",a);case 40:case 41:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"resolve",value:function(){var t=Object(Y.a)(Object(X.a)().mark((function t(n,r){var a;return Object(X.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(me.fetch)(Object(ye.a)(n,e.ACTION_PATH.IDENTIFIERS,r));case 2:if(200===(a=t.sent).status){t.next=10;break}return t.t0=a.status,t.next=7,a.text();case 7:return t.t1=t.sent,t.t2={status:t.t0,text:t.t1},t.abrupt("return",{error:t.t2});case 10:return t.next=12,a.json();case 12:return t.abrupt("return",t.sent);case 13:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"save",value:function(){var e=Object(Y.a)(Object(X.a)().mark((function e(t){return Object(X.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,be.did.put(t);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=Object(Y.a)(Object(X.a)().mark((function e(){var t;return Object(X.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,be.did.get(Ie.ID);case 2:if(!(t=e.sent)){e.next=5;break}return e.abrupt("return",new Ie(t.scheme,t.method,t.didSuffix,t.longFormSuffixData,t.signingKeyId,t.published));case 5:return e.abrupt("return",null);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"clear",value:function(){var e=Object(Y.a)(Object(X.a)().mark((function e(){return Object(X.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,be.did.clear();case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),e}();De.ACTION_PATH={OPERATIONS:"operations",IDENTIFIERS:"identifiers",PROOF:"proof-of-work-challenge"};var Ce=function(){function e(){Object(le.a)(this,e)}return Object(pe.a)(e,null,[{key:"save",value:function(){var e=Object(Y.a)(Object(X.a)().mark((function e(t,n){return Object(X.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,be.privatekey.put(new Re(t,n));case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=Object(Y.a)(Object(X.a)().mark((function e(t){return Object(X.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,be.privatekey.get(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"clear",value:function(){var e=Object(Y.a)(Object(X.a)().mark((function e(){return Object(X.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,be.privatekey.clear();case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),e}();Ce.RESERVE_ID={RECOVERY:"@RECOVERY",UPDATE:"@UPDATE"};var Ie=function(){function e(t,n,r,a,i){var c=arguments.length>5&&void 0!==arguments[5]&&arguments[5];Object(le.a)(this,e),this.id=void 0,this.scheme=void 0,this.method=void 0,this.didSuffix=void 0,this.longFormSuffixData=void 0,this.signingKeyId=void 0,this.published=void 0,this.id=e.ID,this.scheme=t,this.method=n,this.didSuffix=r,this.longFormSuffixData=a,this.signingKeyId=i,this.published=c}return Object(pe.a)(e,[{key:"did",get:function(){return this.published?this.didShort:this.didLong}},{key:"didShort",get:function(){return[this.scheme,this.method,this.didSuffix].join(":")}},{key:"didLong",get:function(){return[this.scheme,this.method,this.didSuffix,this.longFormSuffixData].join(":")}},{key:"kid",get:function(){return"".concat(this.did,"#").concat(this.signingKeyId)}}]),e}();Ie.ID="onlyid";var Re=Object(pe.a)((function e(t,n){Object(le.a)(this,e),this.id=void 0,this.privateKey=void 0,this.id=t,this.privateKey=n})),Ne=Object(pe.a)((function e(t){Object(le.a)(this,e),this.id=void 0,this.vc=void 0,this.vc=t})),_e=function(){function e(){Object(le.a)(this,e)}return Object(pe.a)(e,null,[{key:"save",value:function(){var e=Object(Y.a)(Object(X.a)().mark((function e(t){return Object(X.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,be.vc.put(new Ne(t));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"all",value:function(){var e=Object(Y.a)(Object(X.a)().mark((function e(){return Object(X.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,be.vc.toArray();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"clear",value:function(){var e=Object(Y.a)(Object(X.a)().mark((function e(){return Object(X.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,be.vc.clear();case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),e}(),Pe=function(){function e(){Object(le.a)(this,e)}return Object(pe.a)(e,null,[{key:"decodeJws",value:function(e){var t=e.split(".");return{header:JSON.parse(ke.a.decode(t[0])),payload:JSON.parse(ke.a.decode(t[1])),jws:e}}},{key:"generateSub",value:function(e){var t=Object(Se.createHash)("sha256"),n='{"crv":"'.concat(e.crv,'","kty":"').concat(e.kty,'","x":"').concat(e.x,'","y":"').concat(e.y,'"}'),r=t.update(n).digest();return ke.a.encode(r)}},{key:"generateHash",value:function(e){var t=Object(Se.createHash)("sha256").update(e).digest();return ke.a.toBase64(ke.a.encode(t))}},{key:"generateKid",value:function(){return Object(Se.createHash)("md5").update((new Date).toString()).digest("hex")}},{key:"generateNonce",value:function(){var e=Object(Se.createHash)("md5").update((new Date).toString()).digest();return ke.a.toBase64(ke.a.encode(e))}},{key:"signJws",value:function(){var e=Object(Y.a)(Object(X.a)().mark((function e(t,n,r){return Object(X.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=r.crv,e.next="secp256k1"===e.t0?3:4;break;case 3:return e.abrupt("return",Ee.ES256K.sign(n,r,t));case 4:throw new Error("Unsupported cryptographic type");case 5:case 6:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"verifyJws",value:function(){var e=Object(Y.a)(Object(X.a)().mark((function e(t,n){return Object(X.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=n.crv,e.next="secp256k1"===e.t0?3:4;break;case 3:return e.abrupt("return",Ee.ES256K.verify(t,n));case 4:throw new Error("Unsupported cryptographic type");case 5:case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"verifyJwsByDid",value:function(){var t=Object(Y.a)(Object(X.a)().mark((function t(n,r){var a,i,c,s,o,d,l,p,x;return Object(X.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,a=n.header.kid.split("#"),i=Object(u.a)(a,2),c=i[0],s=i[1],t.next=4,De.resolve(r,c);case 4:o=t.sent,l=Object(he.a)(o.didDocument.verificationMethod),t.prev=6,l.s();case 8:if((p=l.n()).done){t.next=15;break}if((x=p.value).id!=="#"+s){t.next=13;break}return d=x.publicKeyJwk,t.abrupt("break",15);case 13:t.next=8;break;case 15:t.next=20;break;case 17:t.prev=17,t.t0=t.catch(6),l.e(t.t0);case 20:return t.prev=20,l.f(),t.finish(20);case 23:if(d){t.next=25;break}return t.abrupt("return",!1);case 25:return t.next=28,e.verifyJws(n.jws,d);case 28:return t.abrupt("return",t.sent);case 31:return t.prev=31,t.t1=t.catch(0),t.abrupt("return",!1);case 34:case 35:case"end":return t.stop()}}),t,null,[[0,31],[6,17,20,23]])})));return function(e,n){return t.apply(this,arguments)}}()}]),e}(),Ke=function(){var e=U(),t=z(),n=H(),a=r.useState(!1),i=Object(u.a)(a,2),c=i[0],s=i[1],o=r.useState(!1),d=Object(u.a)(o,2),l=d[0],p=d[1],x=r.useState({title:"",text:""}),j=Object(u.a)(x,2),b=j[0],f=j[1];r.useEffect((function(){return t.settings||g(),function(){}}));var O=function(e,t){"clickaway"!==t&&s(!1)},g=function(){var r=Object(Y.a)(Object(X.a)().mark((function r(){var a;return Object(X.a)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return e.setNowLoading(!0),r.t0=t,r.next=4,fe.load();case 4:return r.t1=r.sent,r.t0.setSettings.call(r.t0,r.t1),r.next=8,De.load();case 8:(a=r.sent)&&n.setDidModel(a),setTimeout((function(){e.setNowLoading(!1)}),300);case 11:case"end":return r.stop()}}),r)})));return function(){return r.apply(this,arguments)}}(),y=function(){var r=Object(Y.a)(Object(X.a)().mark((function r(){var a;return Object(X.a)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.settings){r.next=2;break}return r.abrupt("return");case 2:return e.setNowLoading(!0),r.prev=3,r.next=6,De.create(t.settings.urlOperation,t.settings.needChallenge,"sign-primary-key");case 6:if(!(a=r.sent)){r.next=20;break}return r.next=10,Ce.save(a.didModel.signingKeyId,a.signingPrivateKey);case 10:return r.next=12,Ce.save(Ce.RESERVE_ID.RECOVERY,a.recoveryPrivateKey);case 12:return r.next=14,Ce.save(Ce.RESERVE_ID.UPDATE,a.updatePrivateKey);case 14:return r.next=16,De.save(a.didModel);case 16:n.setDidModel(a.didModel),s(!0),r.next=21;break;case 20:alert("DID\u306e\u767a\u884c\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002");case 21:r.next=26;break;case 23:r.prev=23,r.t0=r.catch(3),alert("DID\u306e\u767a\u884c\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002");case 26:setTimeout((function(){e.setNowLoading(!1)}),300);case 27:case"end":return r.stop()}}),r,null,[[3,23]])})));return function(){return r.apply(this,arguments)}}(),m=function(){var e=Object(Y.a)(Object(X.a)().mark((function e(){return Object(X.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.didModel){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,k(n.didModel.didShort);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),w=function(){var e=Object(Y.a)(Object(X.a)().mark((function e(){return Object(X.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.didModel){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,k(n.didModel.didLong);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),k=function(){var r=Object(Y.a)(Object(X.a)().mark((function r(a){var i;return Object(X.a)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.settings){r.next=2;break}return r.abrupt("return");case 2:if(n.didModel){r.next=4;break}return r.abrupt("return");case 4:return e.setNowLoading(!0),r.next=7,De.resolve(t.settings.urlResolve,a);case 7:if((i=r.sent).error){r.next=15;break}if(n.didModel.published){r.next=15;break}if(!i.didDocumentMetadata.method.published){r.next=15;break}return n.didModel.published=!0,n.setDidModel(n.didModel),r.next=15,De.save(n.didModel);case 15:setTimeout((function(){f({title:"DID\u691c\u8a3c\u30ec\u30b9\u30dd\u30f3\u30b9",text:JSON.stringify(i,null,2)}),p(!0),e.setNowLoading(!1)}),500);case 16:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}(),S=function(){var t=Object(Y.a)(Object(X.a)().mark((function t(){return Object(X.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.setNowLoading(!0),t.next=3,_e.clear();case 3:return t.next=5,Ce.clear();case 5:return t.next=7,De.clear();case 7:n.setDidModel(null),setTimeout((function(){e.setNowLoading(!1)}),300);case 9:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),E=function(){var e=Object(Y.a)(Object(X.a)().mark((function e(){return Object(X.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:p(!1);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();if(!n.didModel)return Object(L.jsxs)(L.Fragment,{children:[Object(L.jsxs)(G.a,{maxWidth:"sm",sx:{paddingX:"8px"},children:[Object(L.jsx)(h.a,{variant:"h5",sx:{marginBottom:"16px"},children:"DID"}),Object(L.jsxs)($.a,{container:!0,spacing:2,children:[Object(L.jsx)($.a,{item:!0,xs:12,children:"DID\u304c\u767a\u884c\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002"}),Object(L.jsx)($.a,{container:!0,item:!0,xs:12,justifyContent:"center",children:Object(L.jsx)(Q.a,{variant:"contained",size:"large",startIcon:Object(L.jsx)(de.a,{}),onClick:y,children:"DID\u767a\u884c"})})]})]}),Object(L.jsx)(Z.a,{open:c,autoHideDuration:6e3,onClose:O,children:Object(L.jsx)(ee.a,{onClose:O,severity:"success",sx:{width:"100%"},children:"DID\u3092\u767a\u884c\u3057\u307e\u3057\u305f\u3002"})})]});var D=n.didModel.published?Object(L.jsx)(te.a,{label:"\u516c\u958b\u6e08",color:"success"}):Object(L.jsx)(te.a,{label:"\u672a\u516c\u958b",color:"warning"});return Object(L.jsxs)(L.Fragment,{children:[Object(L.jsxs)(G.a,{maxWidth:"sm",sx:{paddingX:"8px"},children:[Object(L.jsx)(h.a,{variant:"h5",sx:{marginBottom:"16px"},children:"DID"}),Object(L.jsx)($.a,{container:!0,spacing:2,children:Object(L.jsx)($.a,{item:!0,xs:12,children:Object(L.jsxs)(ne.a,{variant:"outlined",children:[Object(L.jsxs)(re.a,{children:[Object(L.jsx)(ae.a,{label:"DID",fullWidth:!0,multiline:!0,value:n.didModel.didShort,InputProps:{readOnly:!0}}),Object(L.jsx)(G.a,{fixed:!0,sx:{marginTop:"8px",textAlign:"right"},children:D})]}),Object(L.jsx)(v.a,{sx:{marginX:"8px"}}),Object(L.jsxs)(ie.a,{children:[Object(L.jsx)(Q.a,{size:"small",onClick:m,children:"DID\u3092\u691c\u8a3c"}),Object(L.jsx)(Q.a,{size:"small",onClick:w,children:"DID(Long)\u3092\u691c\u8a3c"}),Object(L.jsx)(Q.a,{size:"small",color:"error",onClick:S,children:"\u524a\u9664"})]})]})})})]}),Object(L.jsx)(Z.a,{open:c,autoHideDuration:6e3,onClose:O,children:Object(L.jsx)(ee.a,{onClose:O,severity:"success",sx:{width:"100%"},children:"DID\u3092\u767a\u884c\u3057\u307e\u3057\u305f\u3002"})}),Object(L.jsxs)(ce.a,{fullWidth:!0,maxWidth:"sm",open:l,"aria-labelledby":"responsive-dialog-title",children:[Object(L.jsx)(se.a,{id:"responsive-dialog-title",children:b.title}),Object(L.jsx)(oe.a,{children:Object(L.jsx)(ae.a,{label:"DID",fullWidth:!0,multiline:!0,maxRows:16,value:b.text,InputProps:{readOnly:!0,sx:{fontSize:"11px"}},sx:{marginTop:"8px"}})}),Object(L.jsx)(ue.a,{children:Object(L.jsx)(Q.a,{onClick:E,autoFocus:!0,children:"OK"})})]})]})},Le=n(239),Te=0,Me=1,We=function(){var e=r.useState(Te),t=Object(u.a)(e,2),n=t[0],a=t[1],i=r.useState(""),c=Object(u.a)(i,2),s=c[0],d=c[1],l=r.useState(""),p=Object(u.a)(l,2),x=p[0],j=p[1],b=H(),f=z(),O=Object(o.h)();if(!b.didModel)return Object(L.jsx)(o.a,{to:"/",replace:!0});var v=function(){var e=Object(Y.a)(Object(X.a)().mark((function e(){return Object(X.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:g(x);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),g=function(){var e=Object(Y.a)(Object(X.a)().mark((function e(t){return Object(X.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f.settings){e.next=2;break}return e.abrupt("return");case 2:if(b.didModel){e.next=5;break}return e.abrupt("return");case 5:if(0===t.indexOf("openid://")){e.next=9;break}return alert("openid:// \u5f62\u5f0f\u306e\u307f\u6709\u52b9\u3067\u3059"),e.abrupt("return");case 9:O("/openid/"+ke.a.encode(t));case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),y=Object(L.jsx)(Le.a,{constraints:{facingMode:"environment"},onResult:function(e){e&&(console.log(e),d(e.getText()),a(Me),0===e.getText().indexOf("openid://vc")&&g(e.getText()))}}),m=Object(L.jsx)(ne.a,{variant:"outlined",children:Object(L.jsxs)(re.a,{children:[Object(L.jsx)(h.a,{variant:"h6",children:"QR\u8aad\u307f\u53d6\u308a\u7d50\u679c"}),Object(L.jsx)(h.a,{sx:{wordWrap:"break-word",marginTop:"16px"},children:s})]})});return Object(L.jsxs)(G.a,{maxWidth:"sm",sx:{paddingX:"8px"},children:[Object(L.jsx)(h.a,{variant:"h5",sx:{marginBottom:"16px"},children:"QR\u8aad\u307f\u53d6\u308a"}),Object(L.jsx)(G.a,{maxWidth:"sm",children:n===Me?m:y}),Object(L.jsxs)(G.a,{maxWidth:"sm",sx:{marginTop:"16px"},children:[Object(L.jsx)(ae.a,{id:"input-text",label:"URL(openid://)",fullWidth:!0,multiline:!0,maxRows:6,size:"small",value:x,onChange:function(e){if("input-text"===e.target.id)j((function(){return e.target.value}))}}),Object(L.jsx)(Q.a,{variant:"contained",sx:{marginTop:"8px"},onClick:v,children:"\u624b\u5165\u529b"})]})]})},Je=n(481),Be=n(507),Ae=n(508),Ue=n(472),Ve=function(){var e=H(),t=r.useState({signing:"",recovery:"",update:""}),n=Object(u.a)(t,2),a=n[0],i=n[1];r.useEffect((function(){return a.signing||c(),function(){}}));var c=function(){var t=Object(Y.a)(Object(X.a)().mark((function t(){var n,r,a;return Object(X.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.didModel){t.next=46;break}return t.t0=i,t.t1=JSON,t.next=5,Ce.load(e.didModel.signingKeyId);case 5:if(t.t3=n=t.sent,t.t2=null===t.t3,t.t2){t.next=9;break}t.t2=void 0===n;case 9:if(!t.t2){t.next=13;break}t.t4=void 0,t.next=14;break;case 13:t.t4=n.privateKey;case 14:return t.t5=t.t4,t.t6=t.t1.stringify.call(t.t1,t.t5,null,2),t.t7=JSON,t.next=19,Ce.load(Ce.RESERVE_ID.RECOVERY);case 19:if(t.t9=r=t.sent,t.t8=null===t.t9,t.t8){t.next=23;break}t.t8=void 0===r;case 23:if(!t.t8){t.next=27;break}t.t10=void 0,t.next=28;break;case 27:t.t10=r.privateKey;case 28:return t.t11=t.t10,t.t12=t.t7.stringify.call(t.t7,t.t11,null,2),t.t13=JSON,t.next=33,Ce.load(Ce.RESERVE_ID.UPDATE);case 33:if(t.t15=a=t.sent,t.t14=null===t.t15,t.t14){t.next=37;break}t.t14=void 0===a;case 37:if(!t.t14){t.next=41;break}t.t16=void 0,t.next=42;break;case 41:t.t16=a.privateKey;case 42:t.t17=t.t16,t.t18=t.t13.stringify.call(t.t13,t.t17,null,2),t.t19={signing:t.t6,recovery:t.t12,update:t.t18},(0,t.t0)(t.t19);case 46:case 47:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return e.didModel?Object(L.jsx)(L.Fragment,{children:Object(L.jsxs)(G.a,{maxWidth:"sm",sx:{paddingX:"8px"},children:[Object(L.jsx)(h.a,{variant:"h5",sx:{marginBottom:"16px"},children:"DID\u8a73\u7d30"}),Object(L.jsxs)(Je.a,{children:[Object(L.jsx)(Be.a,{expandIcon:Object(L.jsx)(Ue.a,{}),children:Object(L.jsx)(h.a,{children:"DID(Long)"})}),Object(L.jsx)(Ae.a,{children:Object(L.jsx)(ae.a,{label:"DID(Long)",fullWidth:!0,multiline:!0,maxRows:8,value:e.didModel.didLong,InputProps:{readOnly:!0,sx:{fontSize:"12px"}}})})]}),Object(L.jsxs)(Je.a,{children:[Object(L.jsx)(Be.a,{expandIcon:Object(L.jsx)(Ue.a,{}),children:Object(L.jsx)(h.a,{children:"SigningPrivateKey"})}),Object(L.jsx)(Ae.a,{children:Object(L.jsx)(ae.a,{label:"SigningPrivateKey",fullWidth:!0,multiline:!0,maxRows:8,value:a.signing,InputProps:{readOnly:!0,sx:{fontSize:"12px"}}})})]}),Object(L.jsxs)(Je.a,{children:[Object(L.jsx)(Be.a,{expandIcon:Object(L.jsx)(Ue.a,{}),children:Object(L.jsx)(h.a,{children:"RecoveryPrivateKey"})}),Object(L.jsx)(Ae.a,{children:Object(L.jsx)(ae.a,{label:"RecoveryPrivateKey",fullWidth:!0,multiline:!0,maxRows:8,value:a.recovery,InputProps:{readOnly:!0,sx:{fontSize:"12px"}}})})]}),Object(L.jsxs)(Je.a,{children:[Object(L.jsx)(Be.a,{expandIcon:Object(L.jsx)(Ue.a,{}),children:Object(L.jsx)(h.a,{children:"UpdatePrivateKey"})}),Object(L.jsx)(Ae.a,{children:Object(L.jsx)(ae.a,{label:"UpdatePrivateKey",fullWidth:!0,multiline:!0,maxRows:8,value:a.update,InputProps:{readOnly:!0,sx:{fontSize:"12px"}}})})]})]})}):Object(L.jsx)(o.a,{to:"/",replace:!0})},ze=function(){var e=H(),t=r.useState([]),n=Object(u.a)(t,2),a=n[0],i=n[1];r.useEffect((function(){return a.length||c(),function(){}}));var c=function(){var e=Object(Y.a)(Object(X.a)().mark((function e(){var t;return Object(X.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_e.all();case 2:t=e.sent,i(t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();if(!e.didModel)return Object(L.jsx)(o.a,{to:"/",replace:!0});for(var s=[],d=0;d<a.length;d++)s.push(Object(L.jsxs)(Je.a,{children:[Object(L.jsx)(Be.a,{expandIcon:Object(L.jsx)(Ue.a,{}),children:Object(L.jsxs)(h.a,{children:["VC ",d]})}),Object(L.jsx)(Ae.a,{children:Object(L.jsx)(ae.a,{label:"vc",fullWidth:!0,multiline:!0,maxRows:8,value:JSON.stringify(a[d].vc.payload,null,2),InputProps:{readOnly:!0,sx:{fontSize:"12px"}}})})]},"ac_"+d));return Object(L.jsx)(L.Fragment,{children:Object(L.jsxs)(G.a,{maxWidth:"sm",sx:{paddingX:"8px"},children:[Object(L.jsx)(h.a,{variant:"h5",sx:{marginBottom:"16px"},children:"VC\u4e00\u89a7"}),s]})})},Fe=n(509),He=n(489),qe=n(128),Xe=n(482),Ye=0,Ge=1,$e=11,Qe=12,Ze=21,et=22,tt=31,nt=32,rt=function(){var e=Object(o.g)().search,t=Object(o.i)().param,n=r.useState(Ye),a=Object(u.a)(n,2),i=a[0],c=a[1],s=r.useState(""),d=Object(u.a)(s,2),l=d[0],p=d[1],x=r.useState({credentialOffer:{},vcExpert:{}}),j=Object(u.a)(x,2),b=j[0],f=j[1],O=r.useState({credentialOffer:{},vcList:[]}),v=Object(u.a)(O,2),g=v[0],y=v[1],m=H(),w=z(),k=U(),S=Object(o.h)();r.useEffect((function(){switch(console.log(i),i){case Ye:k.setNowLoading(!0),E();break;case Ge:D()}}),[i]);var E=function(){var e=Object(Y.a)(Object(X.a)().mark((function e(){var t;return Object(X.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i!==Ye){e.next=11;break}return e.t0=w,e.next=4,fe.load();case 4:return e.t1=e.sent,e.t0.setSettings.call(e.t0,e.t1),e.next=8,De.load();case 8:(t=e.sent)&&m.setDidModel(t),c(Ge);case 11:case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),D=function(){var e=Object(Y.a)(Object(X.a)().mark((function e(){var n,r;return Object(X.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=23;break}return e.t0=w,e.next=4,fe.load();case 4:return e.t1=e.sent,e.t0.setSettings.call(e.t0,e.t1),e.next=8,De.load();case 8:if((n=e.sent)&&m.setDidModel(n),0!==(r=ke.a.decode(t)).indexOf("openid://vc/")){e.next=14;break}return P(r),e.abrupt("return");case 14:if(0!==r.indexOf("openid://vc2/")){e.next=17;break}return C(r),e.abrupt("return");case 17:if(0!==r.indexOf("openid://vc3/")){e.next=20;break}return R(r),e.abrupt("return");case 20:if(0!==r.indexOf("openidres://vc2/")){e.next=23;break}return I(r),e.abrupt("return");case 23:S("/");case 24:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),C=function(){var e=Object(Y.a)(Object(X.a)().mark((function e(t){var n,r;return Object(X.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=qe.parseUrl(t),(r=new URL(n.query.request_uri)).searchParams.append("response_type","code"),r.searchParams.append("client_id","xxx"),r.searchParams.append("scope","idToken"),r.searchParams.append("nonce","xxx"),r.searchParams.append("redirect_uri","".concat(window.location.origin,"/openid/")+ke.a.encode("openidres://vc2/#"+r.origin)),r.searchParams.append("authorization_details",JSON.stringify({type:"openid_credential",credential_type:"https://ssird-issuer.com/nameCard",format:"jwt_vc"})),window.location.href=r.toString();case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),I=function(){var t=Object(Y.a)(Object(X.a)().mark((function t(n){var r,a,i,s,o,u,d,l,p,x,j;return Object(X.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(w.settings){t.next=2;break}return t.abrupt("return");case 2:if(m.didModel){t.next=4;break}return t.abrupt("return");case 4:return t.prev=4,r=n.split("#")[1],a=new URLSearchParams(e),t.next=9,Object(me.fetch)("".concat(r,"/token"),{method:"POST",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json"},body:JSON.stringify({grant_type:"suthorization_code",client_id:"xxx",client_secret:"yyy",code:a.get("code")})});case 9:return i=t.sent,t.next=12,i.json();case 12:return s=t.sent,console.log(s),o=Math.floor(Date.now()/1e3),u={header:{alg:"ES256K",typ:"JWT",kid:m.didModel.kid},payload:{iss:"xxx",aud:"https://ssird-issuer.com",iat:o,exp:o+600,nonce:s.nonce}},console.log(u),t.next=19,Ce.load(m.didModel.signingKeyId);case 19:return d=t.sent,t.next=22,Pe.signJws(u.header,u.payload,null===d||void 0===d?void 0:d.privateKey);case 22:return l=t.sent,t.next=25,Object(me.fetch)("".concat(r,"/vc"),{method:"POST",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(s.access_token)},body:JSON.stringify({proof_type:"jwt",jwt:l})});case 25:return p=t.sent,t.next=28,p.json();case 28:return x=t.sent,console.log(x),j=Pe.decodeJws(x.credential),console.log(j),t.next=34,Pe.verifyJwsByDid(j,w.settings.urlResolve);case 34:if(t.sent){t.next=36;break}throw new Error("verifyJwsByDid NG: CredentialOffer");case 36:return console.log("verifyJwsByDid OK"),t.next=40,_e.save(j);case 40:c(Qe),t.next=47;break;case 43:t.prev=43,t.t0=t.catch(4),console.error(t.t0),alert(t.t0.message||t.t0);case 47:setTimeout((function(){k.setNowLoading(!1)}),300);case 49:case"end":return t.stop()}}),t,null,[[4,43]])})));return function(e){return t.apply(this,arguments)}}(),R=function(){var e=Object(Y.a)(Object(X.a)().mark((function e(t){var n,r,a;return Object(X.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,k.setNowLoading(!0),w.settings){e.next=4;break}throw new Error("Not initialized");case 4:return n=qe.parseUrl(t),r=Pe.decodeJws(n.query.request),console.log(r),e.next=10,Pe.verifyJwsByDid(r,w.settings.urlResolve);case 10:if(e.sent){e.next=12;break}alert("verifyJwsByDid NG");case 12:return console.log("verifyJwsByDid OK"),e.next=16,_e.all();case 16:if((a=e.sent).length){e.next=19;break}throw Error("VC not found.");case 19:y({credentialOffer:r,vcList:a}),c(tt),e.next=27;break;case 23:e.prev=23,e.t0=e.catch(0),console.error(e.t0),alert(e.t0.message||e.t0);case 27:setTimeout((function(){k.setNowLoading(!1)}),300);case 29:case"end":return e.stop()}}),e,null,[[0,23]])})));return function(t){return e.apply(this,arguments)}}(),N=function(){var e=Object(Y.a)(Object(X.a)().mark((function e(t){var n,r,a,i;return Object(X.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(w.settings){e.next=2;break}throw new Error("Not initialized");case 2:return n=qe.parseUrl(t),e.next=6,Object(me.fetch)(n.query.request_uri);case 6:return r=e.sent,e.next=9,r.text();case 9:return a=e.sent,i=Pe.decodeJws(a),console.log(i),e.next=14,Pe.verifyJwsByDid(i,w.settings.urlResolve);case 14:if(e.sent){e.next=16;break}throw new Error("verifyJwsByDid NG: CredentialOffer");case 16:return console.log("verifyJwsByDid OK"),e.abrupt("return",i);case 19:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),_=function(){var e=Object(Y.a)(Object(X.a)().mark((function e(t){var n,r,a;return Object(X.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(w.settings){e.next=2;break}throw new Error("Not initialized");case 2:return e.next=5,Object(me.fetch)(t);case 5:return n=e.sent,e.next=8,n.json();case 8:return r=e.sent,a=Pe.decodeJws(r.token),console.log(a),e.next=13,Pe.verifyJwsByDid(a,w.settings.urlResolve);case 13:if(e.sent){e.next=15;break}throw new Error("verifyJwsByDid NG: CredentialOffer");case 15:return console.log("verifyJwsByDid OK"),e.abrupt("return",a);case 18:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),P=function(){var e=Object(Y.a)(Object(X.a)().mark((function e(t){var n;return Object(X.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0===t.indexOf("openid://vc/")){e.next=3;break}return alert("openid://vc/ \u5f62\u5f0f\u306e\u307f\u6709\u52b9\u3067\u3059"),e.abrupt("return");case 3:return e.prev=4,k.setNowLoading(!0),e.next=8,N(t);case 8:(n=e.sent).payload.prompt&&"create"===n.payload.prompt?T(n):K(n),e.next=17;break;case 12:e.prev=12,e.t0=e.catch(4),console.error(e.t0),alert(e.t0.message||e.t0),k.setNowLoading(!1);case 17:case 18:case"end":return e.stop()}}),e,null,[[4,12]])})));return function(t){return e.apply(this,arguments)}}(),K=function(){var e=Object(Y.a)(Object(X.a)().mark((function e(t){var n;return Object(X.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,_e.all();case 3:if((n=e.sent).length){e.next=6;break}throw Error("VC not found.");case 6:y({credentialOffer:t,vcList:n}),c(Ze),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(0),console.error(e.t0),alert(e.t0.message||e.t0);case 14:setTimeout((function(){k.setNowLoading(!1)}),300);case 16:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t){return e.apply(this,arguments)}}(),T=function(){var e=Object(Y.a)(Object(X.a)().mark((function e(t){var n,r;return Object(X.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=t.payload.claims.vp_token.presentation_definition.input_descriptors[0].issuance[0].manifest2,e.next=4,_(n);case 4:r=e.sent,f({credentialOffer:t,vcExpert:r}),c($e),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),console.error(e.t0),alert(e.t0.message||e.t0);case 13:setTimeout((function(){k.setNowLoading(!1)}),300);case 15:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t){return e.apply(this,arguments)}}(),M=function(){var e=Object(Y.a)(Object(X.a)().mark((function e(){var t,n,r,a,i,s,o,u;return Object(X.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(w.settings){e.next=2;break}return e.abrupt("return");case 2:if(m.didModel){e.next=4;break}return e.abrupt("return");case 4:return e.prev=4,k.setNowLoading(!0),e.next=8,De.resolve(w.settings.urlResolve,m.didModel.did);case 8:return t=e.sent,n=Math.floor(Date.now()/1e3),(r={header:{alg:"ES256K",typ:"JWT",kid:m.didModel.kid},payload:{iss:"https://self-issued.me",aud:b.vcExpert.payload.input.credentialIssuer,contract:b.vcExpert.payload.display.contract,iat:n,exp:n+600,sub_jwk:JSON.parse(JSON.stringify(t.didDocument.verificationMethod[0].publicKeyJwk)),sub:Pe.generateSub(t.didDocument.verificationMethod[0].publicKeyJwk),jti:Xe.a(),did:m.didModel.did,pin:Pe.generateHash(l),attestations:{idTokens:{"https://self-issued.me":b.credentialOffer.payload.id_token_hint}}}}).payload.aud.indexOf("/api/issuer/card")>-1&&(r.payload.aud="https://beta.did.msidentity.com/v1.0/f55d947c-0f8e-48d7-b1ea-b7f5c99291ce/verifiableCredential/card/issue"),console.log(r),e.next=16,Ce.load(m.didModel.signingKeyId);case 16:return a=e.sent,e.next=19,Pe.signJws(r.header,r.payload,null===a||void 0===a?void 0:a.privateKey);case 19:return i=e.sent,e.next=22,Object(me.fetch)(b.vcExpert.payload.input.credentialIssuer,{method:"POST",mode:"cors",cache:"no-cache",body:i});case 22:if(200===(s=e.sent).status){e.next=29;break}return e.t0=Error,e.next=27,s.text();case 27:throw e.t1=e.sent,(0,e.t0)(e.t1);case 29:return e.next=31,s.json();case 31:return o=e.sent,u=Pe.decodeJws(o.vc),console.log(u),e.next=36,Pe.verifyJwsByDid(u,w.settings.urlResolve);case 36:if(e.sent){e.next=38;break}throw new Error("verifyJwsByDid NG: CredentialOffer");case 38:return console.log("verifyJwsByDid OK"),e.next=42,_e.save(u);case 42:c(Qe),e.next=49;break;case 45:e.prev=45,e.t2=e.catch(4),console.error(e.t2),alert(e.t2.message||e.t2);case 49:setTimeout((function(){k.setNowLoading(!1)}),300);case 51:case"end":return e.stop()}}),e,null,[[4,45]])})));return function(){return e.apply(this,arguments)}}(),W=function(){var e=Object(Y.a)(Object(X.a)().mark((function e(){var t,n,r,a,i,s,o,u;return Object(X.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(w.settings){e.next=2;break}return e.abrupt("return");case 2:if(m.didModel){e.next=4;break}return e.abrupt("return");case 4:return e.prev=4,k.setNowLoading(!0),t=Math.floor(Date.now()/1e3),n={header:{alg:"ES256K",typ:"JWT",kid:m.didModel.kid},payload:{iss:"https://self-issued.me/v2/openid-vc",aud:g.credentialOffer.payload.client_id,sub:m.didModel.did,iat:t,exp:t+600,nonce:g.credentialOffer.payload.nonce,_vp_token:{presentation_submission:{id:Xe.a(),definition_id:Xe.a(),descriptor_map:[{id:"VerifiedCredentialExpert",format:"jwt_vp",path:"$",path_nested:{id:"VerifiedCredentialExpert",format:"jwt_vc",path:"$.verifiableCredential[0]"}}]}}}},console.log(n),e.next=11,Ce.load(m.didModel.signingKeyId);case 11:return r=e.sent,e.next=14,Pe.signJws(n.header,n.payload,null===r||void 0===r?void 0:r.privateKey);case 14:return a=e.sent,i={header:{alg:"ES256K",typ:"JWT",kid:m.didModel.kid},payload:{iss:m.didModel.did,aud:g.credentialOffer.payload.client_id,iat:t,nbf:t,exp:t+600,nonce:g.credentialOffer.payload.nonce,vp:{"@context":["https://www.w3.org/2018/credentials/v1"],type:["VerifiablePresentation"],verifiableCredential:[g.vcList[0].vc.jws]}}},console.log(i),e.next=19,Pe.signJws(i.header,i.payload,null===r||void 0===r?void 0:r.privateKey);case 19:return s=e.sent,(o=new URLSearchParams).append("id_token",a),o.append("vp_token",s),o.append("state",g.credentialOffer.payload.state),e.next=26,Object(me.fetch)(g.credentialOffer.payload.redirect_uri,{method:"POST",mode:"cors",cache:"no-cache",body:o});case 26:if(200===(u=e.sent).status){e.next=33;break}return e.t0=Error,e.next=31,u.text();case 31:throw e.t1=e.sent,(0,e.t0)(e.t1);case 33:c(et),e.next=40;break;case 36:e.prev=36,e.t2=e.catch(4),console.error(e.t2),alert(e.t2.message||e.t2);case 40:setTimeout((function(){k.setNowLoading(!1)}),300);case 42:case"end":return e.stop()}}),e,null,[[4,36]])})));return function(){return e.apply(this,arguments)}}(),J=function(){var e=Object(Y.a)(Object(X.a)().mark((function e(){var t,n,r,a,i,s,o,u,d;return Object(X.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(w.settings){e.next=2;break}return e.abrupt("return");case 2:if(m.didModel){e.next=4;break}return e.abrupt("return");case 4:return e.prev=4,k.setNowLoading(!0),e.next=8,De.resolve(w.settings.urlResolve,m.didModel.did);case 8:return t=e.sent,n=Math.floor(Date.now()/1e3),r={header:{alg:"ES256K",typ:"JWT",kid:m.didModel.kid},payload:{iss:"https://self-issued.me/v2",aud:g.credentialOffer.payload.client_id,sub:Pe.generateSub(t.didDocument.verificationMethod[0].publicKeyJwk),sub_jwk:JSON.parse(JSON.stringify(t.didDocument.verificationMethod[0].publicKeyJwk)),iat:n,exp:n+600,auth_time:n,nonce:g.credentialOffer.payload.nonce,_vp_token:{presentation_submission:{id:Xe.a(),definition_id:Xe.a(),descriptor_map:[{id:"VerifiedCredentialExpert",format:"ldp_vp",path:"$",path_nested:{format:"ldp_vc",path:"$.verifiableCredential[0]"}}]}}}},console.log(r),e.next=14,Ce.load(m.didModel.signingKeyId);case 14:return a=e.sent,e.next=17,Pe.signJws(r.header,r.payload,null===a||void 0===a?void 0:a.privateKey);case 17:return i=e.sent,s={header:{alg:"ES256K",typ:"JWT",kid:m.didModel.kid},payload:{"@context":["https://www.w3.org/2018/credentials/v1"],type:["VerifiablePresentation"],verifiableCredential:[g.vcList[0].vc.payload],id:"ebc6f1c2",holder:m.didModel.did,proof:{type:"Ed25519Signature2018",created:(new Date).toISOString(),challenge:g.credentialOffer.payload.nonce,domain:g.credentialOffer.payload.client_id,jws:g.vcList[0].vc.jws,proofPurpose:"authentication",verificationMethod:m.didModel.kid}}},console.log(s),e.next=22,Pe.signJws(s.header,s.payload,null===a||void 0===a?void 0:a.privateKey);case 22:return o=e.sent,(u=new URLSearchParams).append("id_token",i),u.append("vp_token",o),u.append("state",g.credentialOffer.payload.state),e.next=29,Object(me.fetch)(g.credentialOffer.payload.client_id,{method:"POST",mode:"cors",cache:"no-cache",body:u});case 29:if(200===(d=e.sent).status){e.next=36;break}return e.t0=Error,e.next=34,d.text();case 34:throw e.t1=e.sent,(0,e.t0)(e.t1);case 36:c(nt),e.next=43;break;case 39:e.prev=39,e.t2=e.catch(4),console.error(e.t2),alert(e.t2.message||e.t2);case 43:setTimeout((function(){k.setNowLoading(!1)}),300);case 45:case"end":return e.stop()}}),e,null,[[4,39]])})));return function(){return e.apply(this,arguments)}}();return i===Qe?Object(L.jsxs)(G.a,{maxWidth:"sm",sx:{paddingX:"8px"},children:[Object(L.jsx)(h.a,{variant:"h5",sx:{marginBottom:"16px"},children:"VC\u53d7\u3051\u53d6\u308a\u5b8c\u4e86"}),Object(L.jsx)(h.a,{children:"VC\u3092\u30a6\u30a9\u30ec\u30c3\u30c8\u306b\u767b\u9332\u3057\u307e\u3057\u305f\u3002"})]}):i===$e?Object(L.jsxs)(G.a,{maxWidth:"sm",sx:{paddingX:"8px"},children:[Object(L.jsx)(h.a,{variant:"h5",sx:{marginBottom:"16px"},children:"VC\u767a\u884c\u78ba\u8a8d"}),Object(L.jsxs)(ne.a,{sx:{bgcolor:b.vcExpert.payload.display.card.backgroundColor,maxWidth:"360px",marginX:"auto"},children:[Object(L.jsx)(Fe.a,{avatar:Object(L.jsx)(He.a,{src:b.vcExpert.payload.display.card.logo.uri}),title:b.vcExpert.payload.display.card.title,sx:{color:b.vcExpert.payload.display.card.textColor}}),Object(L.jsx)(re.a,{children:Object(L.jsxs)(h.a,{sx:{color:b.vcExpert.payload.display.card.textColor},children:[Object(L.jsx)("br",{}),"Microsoft"]})})]}),Object(L.jsx)(h.a,{sx:{marginTop:"16px"},children:b.vcExpert.payload.display.consent.title}),Object(L.jsx)(ae.a,{id:"input-pin",label:"PIN",fullWidth:!0,sx:{marginTop:"16px"},inputProps:{inputMode:"numeric",pattern:"[0-9]*"},value:l,onChange:function(e){"input-pin"===e.target.id&&p((function(){return e.target.value}))}}),Object(L.jsxs)($.a,{container:!0,spacing:2,sx:{marginTop:"16px"},children:[Object(L.jsx)($.a,{item:!0,xs:6,children:Object(L.jsx)(Q.a,{variant:"outlined",fullWidth:!0,onClick:function(){return S("/")},children:"\u30ad\u30e3\u30f3\u30bb\u30eb"})}),Object(L.jsx)($.a,{item:!0,xs:6,children:Object(L.jsx)(Q.a,{variant:"contained",fullWidth:!0,onClick:M,children:"\u8ffd\u52a0"})})]})]}):i===Ze?Object(L.jsxs)(G.a,{maxWidth:"sm",sx:{paddingX:"8px"},children:[Object(L.jsx)(h.a,{variant:"h5",sx:{marginBottom:"16px"},children:"VC\u63d0\u793a\u78ba\u8a8d"}),Object(L.jsx)(ne.a,{variant:"outlined",children:Object(L.jsxs)(re.a,{children:[Object(L.jsx)(h.a,{sx:{marginBottom:"16px"},children:"\u63d0\u793a\u6761\u4ef6"}),Object(L.jsx)(ae.a,{label:"input_descriptors",fullWidth:!0,multiline:!0,maxRows:8,value:JSON.stringify(g.credentialOffer.payload.claims.vp_token.presentation_definition.input_descriptors,null,2),InputProps:{readOnly:!0,sx:{fontSize:"12px"}}})]})}),Object(L.jsx)(h.a,{sx:{marginTop:"16px"}}),Object(L.jsxs)($.a,{container:!0,spacing:2,sx:{marginTop:"16px"},children:[Object(L.jsx)($.a,{item:!0,xs:6,children:Object(L.jsx)(Q.a,{variant:"outlined",fullWidth:!0,onClick:function(){return S("/")},children:"\u30ad\u30e3\u30f3\u30bb\u30eb"})}),Object(L.jsx)($.a,{item:!0,xs:6,children:Object(L.jsx)(Q.a,{variant:"contained",fullWidth:!0,onClick:W,children:"\u63d0\u793a"})})]})]}):i===tt?Object(L.jsxs)(G.a,{maxWidth:"sm",sx:{paddingX:"8px"},children:[Object(L.jsx)(h.a,{variant:"h5",sx:{marginBottom:"16px"},children:"VC\u63d0\u793a\u78ba\u8a8d"}),Object(L.jsx)(ne.a,{variant:"outlined",children:Object(L.jsxs)(re.a,{children:[Object(L.jsx)(h.a,{sx:{marginBottom:"16px"},children:"\u63d0\u793a\u6761\u4ef6"}),Object(L.jsx)(ae.a,{label:"input_descriptors",fullWidth:!0,multiline:!0,maxRows:8,value:JSON.stringify(g.credentialOffer.payload.presentation_definition.input_descriptors,null,2),InputProps:{readOnly:!0,sx:{fontSize:"12px"}}})]})}),Object(L.jsx)(h.a,{sx:{marginTop:"16px"}}),Object(L.jsxs)($.a,{container:!0,spacing:2,sx:{marginTop:"16px"},children:[Object(L.jsx)($.a,{item:!0,xs:6,children:Object(L.jsx)(Q.a,{variant:"outlined",fullWidth:!0,onClick:function(){return S("/")},children:"\u30ad\u30e3\u30f3\u30bb\u30eb"})}),Object(L.jsx)($.a,{item:!0,xs:6,children:Object(L.jsx)(Q.a,{variant:"contained",fullWidth:!0,onClick:J,children:"\u63d0\u793a"})})]})]}):i===et||i===nt?Object(L.jsxs)(G.a,{maxWidth:"sm",sx:{paddingX:"8px"},children:[Object(L.jsx)(h.a,{variant:"h5",sx:{marginBottom:"16px"},children:"VC\u63d0\u793a\u5b8c\u4e86"}),Object(L.jsx)(h.a,{children:"VC\u306e\u63d0\u793a\u304c\u5b8c\u4e86\u3057\u307e\u3057\u305f\u3002"})]}):Object(L.jsx)(G.a,{maxWidth:"sm",sx:{paddingX:"8px"},children:Object(L.jsx)(h.a,{variant:"h5",sx:{marginBottom:"16px"},children:"Loading . . ."})})},at=n(510),it=n(478),ct=n(473),st=function(){var e=z(),t=r.useState(!1),n=Object(u.a)(t,2),a=n[0],i=n[1],c=r.useState(""),s=Object(u.a)(c,2),o=s[0],d=s[1],l=r.useState(""),p=Object(u.a)(l,2),x=p[0],j=p[1],b=r.useState(!0),f=Object(u.a)(b,2),O=f[0],v=f[1],g=function(e){switch(e.target.id){case"url-operation":d((function(){return e.target.value}));break;case"url-resolve":j((function(){return e.target.value}));break;case"need-challenge":v((function(){return e.target.checked}))}},y=function(e,t){"clickaway"!==t&&i(!1)},m=function(){var t=Object(Y.a)(Object(X.a)().mark((function t(){var n;return Object(X.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(n=new fe).urlOperation=o,n.urlResolve=x,n.needChallenge=O,t.next=6,n.save();case 6:e.setSettings(n),i(!0);case 8:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),w=function(){var t=Object(Y.a)(Object(X.a)().mark((function t(){var n;return Object(X.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fe.clear();case 2:n=new fe,e.setSettings(n),d(n.urlOperation),j(n.urlResolve),v(n.needChallenge);case 7:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return r.useEffect((function(){return fe.load().then((function(e){d(e.urlOperation),j(e.urlResolve),v(e.needChallenge)})),function(){}}),[]),Object(L.jsxs)(L.Fragment,{children:[Object(L.jsxs)(G.a,{maxWidth:"sm",sx:{paddingX:"8px"},children:[Object(L.jsx)(h.a,{variant:"h5",sx:{marginBottom:"16px"},children:"Settings"}),Object(L.jsxs)($.a,{container:!0,spacing:2,children:[Object(L.jsx)($.a,{item:!0,xs:12,children:Object(L.jsx)(ae.a,{id:"url-operation",fullWidth:!0,label:"Operation URL",variant:"outlined",value:o,onChange:g})}),Object(L.jsx)($.a,{item:!0,xs:12,children:Object(L.jsx)(at.a,{control:Object(L.jsx)(it.a,{id:"need-challenge",checked:O,onChange:g}),label:"Need Challenge"})}),Object(L.jsx)($.a,{item:!0,xs:12,children:Object(L.jsx)(ae.a,{id:"url-resolve",fullWidth:!0,label:"Resolve URL",variant:"outlined",value:x,onChange:g})}),Object(L.jsx)($.a,{item:!0,xs:8,children:Object(L.jsx)(Q.a,{fullWidth:!0,variant:"contained",startIcon:Object(L.jsx)(ct.a,{}),onClick:m,children:"\u4fdd\u5b58"})}),Object(L.jsx)($.a,{item:!0,xs:4,children:Object(L.jsx)(Q.a,{fullWidth:!0,variant:"contained",color:"error",onClick:w,children:"\u30ea\u30bb\u30c3\u30c8"})})]})]}),Object(L.jsx)(Z.a,{open:a,autoHideDuration:6e3,onClose:y,children:Object(L.jsx)(ee.a,{onClose:y,severity:"success",sx:{width:"100%"},children:"\u8a2d\u5b9a\u3092\u4fdd\u5b58\u3057\u307e\u3057\u305f\u3002"})})]})},ot=function(){return Object(L.jsx)(s.a,{children:Object(L.jsx)(o.e,{children:Object(L.jsxs)(o.c,{element:Object(L.jsx)(q,{}),children:[Object(L.jsx)(o.c,{index:!0,element:Object(L.jsx)(Ke,{})}),Object(L.jsx)(o.c,{path:"qr",element:Object(L.jsx)(We,{})}),Object(L.jsx)(o.c,{path:"did",element:Object(L.jsx)(Ve,{})}),Object(L.jsx)(o.c,{path:"vc",element:Object(L.jsx)(ze,{})}),Object(L.jsx)(o.c,{path:"openid/:param",element:Object(L.jsx)(rt,{})}),Object(L.jsx)(o.c,{path:"settings",element:Object(L.jsx)(st,{})})]})})})},ut=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function dt(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){e.waiting&&t&&t.onUpdate&&t.onUpdate(e);var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state?navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://cra.link/PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)):"activated"===n.state&&window.location.reload()})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var lt=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,512)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,i=t.getLCP,c=t.getTTFB;n(e),r(e),a(e),i(e),c(e)}))},pt=n(511),xt=function(e){var t=e.registration,n=Object(r.useState)(!!t.waiting),a=Object(u.a)(n,2),i=a[0],c=a[1];return Object(L.jsxs)(ce.a,{open:i,children:[Object(L.jsx)(se.a,{style:{textAlign:"center"},children:"\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u901a\u77e5"}),Object(L.jsx)(oe.a,{children:Object(L.jsx)(pt.a,{children:"\u65b0\u3057\u3044\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u30ea\u30ea\u30fc\u30b9\u3055\u308c\u307e\u3057\u305f\u3002"})}),Object(L.jsx)(ue.a,{sx:{justifyContent:"center"},children:Object(L.jsx)(Q.a,{onClick:function(){var e;null===(e=t.waiting)||void 0===e||e.postMessage({type:"SKIP_WAITING"}),c(!1)},children:"\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8"})})]})};c.a.render(Object(L.jsx)(a.a.StrictMode,{children:Object(L.jsx)(ot,{})}),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("","/service-worker.js");ut?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var r=n.headers.get("content-type");404===n.status||null!=r&&-1===r.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):dt(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://cra.link/PWA")}))):dt(t,e)}))}}({onUpdate:function(e){e.waiting&&c.a.render(Object(L.jsx)(xt,{registration:e}),document.querySelector(".SW-update-dialog"))}}),lt()}},[[409,1,2]]]);
//# sourceMappingURL=main.6eb4dcd4.chunk.js.map